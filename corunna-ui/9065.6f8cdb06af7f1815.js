"use strict";(self.webpackChunkcorunna_ui=self.webpackChunkcorunna_ui||[]).push([[9065],{9065:(q,x,r)=>{r.r(x),r.d(x,{DashboardModule:()=>ht});var b=r(9595),y=r(5861),T=r(6308),l=r(4006),A=r(4733),C=r(4669),h=r(5115),p=r(9063),f=r(4850),t=r(4650);let I=(()=>{class a extends f.q2{constructor(){super(p.VN.ADMIN,"nix",!0)}getDashboardData(e){return this.post({endPoint:[p.ip.dashboard],payload:e})}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var O=r(6463),E=r(5866),D=r(8033),w=r(374),U=r(4327),B=r(1481),L=r(529),F=r(6895),j=r(2993),m=r(8118),Y=r(9492),S=r(2054);let $=(()=>{class a{constructor(){this.chartData=[],this.option={title:{text:"Chart"},xAxis:{type:"category",data:["2023","2024"]},yAxis:{type:"value"},series:[{type:"bar",data:[120,200,150,80,70,110,130]}]}}ngOnInit(){}ngOnChanges(e){this.formatDataFormChart(this.chartData)}onChartInit(e){this.echartsInstance=e}formatDataFormChart(e){console.log(e);const n=[];e.forEach(i=>{i.inputs.forEach(d=>{n.push({...d})})});const o=this.chartData.map(i=>i?._id),c=(0,p.xs)(n,["inputLabel","lgaName"],"--"),u=[];for(const[i,d]of Object.entries(c)){const g=d,v=[];for(let Z=0;Z<o.length;Z++)for(let _=0;_<g.length;_++){const J=g[_],N=n.find(Q=>Q.inputLabel==J.inputLabel&&Q.lgaName==J.lgaName&&Q.title==o[Z]);v?.push(N?{name:N,value:N.inputValue}:{name:void 0,value:0})}u.push({type:"bar",name:i,stack:i.split("--").at(0),data:v,emphasis:{focus:"series"},label:{show:!0,rotate:90,formatter:Z=>{const _=Z.data;return _.name?`${(0,p.bY)(_.name.inputValue)}`:""}}})}this.option={grid:{containLabel:!0},toolbox:{orient:"vertical",left:"right",top:"center",feature:{restore:{show:!0},magicType:{show:!0,type:["stack"]},saveAsImage:{show:!0,name:"PlaniX Chart"}}},tooltip:{formatter:i=>{const d=i.data?.name;return`${d.outcome} - ${d.subTitle} - ${d.date} = ${(0,p.bY)(d.inputValue)}`}},xAxis:[{type:"category",data:o,axisLabel:{rotate:12}}],yAxis:[{type:"value"}],series:u}}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["healmah-dashboard-chart"]],inputs:{chartData:"chartData"},features:[t.TTD],decls:1,vars:1,consts:[["echarts","",1,"h:85vh","w:100%!","mt:15",3,"options","chartInit"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0),t.NdJ("chartInit",function(u){return o.onChartInit(u)}),t.qZA()),2&n&&t.Q6J("options",o.option)},dependencies:[S._w]})}return a})();var W=r(676);function R(a,s){if(1&a&&(t.TgZ(0,"option",30),t._uU(1),t.qZA()),2&a){const e=s.$implicit;t.Q6J("value",null==e?null:e._id),t.xp6(1),t.hij(" ",null==e?null:e.sectorName," ")}}function P(a,s){if(1&a&&(t.TgZ(0,"option",30),t._uU(1),t.qZA()),2&a){const e=s.$implicit;t.Q6J("value",null==e?null:e._id),t.xp6(1),t.hij(" ",null==e?null:e.lgaName," ")}}function G(a,s){if(1&a&&(t.TgZ(0,"option",30),t._uU(1),t.qZA()),2&a){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function V(a,s){if(1&a&&(t.TgZ(0,"div",31)(1,"div")(2,"label"),t._uU(3,"LGA:"),t.qZA(),t.TgZ(4,"select",32)(5,"option",33),t._uU(6,"All"),t.qZA(),t.YNc(7,P,2,2,"option",16),t.qZA()(),t.TgZ(8,"div")(9,"label"),t._uU(10,"Ward:"),t.qZA(),t.TgZ(11,"select",34)(12,"option",33),t._uU(13,"All"),t.qZA(),t.YNc(14,G,2,2,"option",16),t.qZA()()()),2&a){const e=t.oxw();t.xp6(7),t.Q6J("ngForOf",e.lgas),t.xp6(7),t.Q6J("ngForOf",e.lgaWards)}}function K(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",37),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.exportChartData())}),t._uU(1," Export Result "),t.qZA()}}function k(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",37),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.exportTableData())}),t._uU(1," Export Result "),t.qZA()}}function z(a,s){if(1&a&&(t.TgZ(0,"div",35),t.YNc(1,K,2,0,"button",36),t.YNc(2,k,2,0,"button",36),t.qZA()),2&a){const e=t.oxw();let n,o;t.xp6(1),t.Q6J("ngIf",e.chartData.length&&"Charts"==(null==(n=e.dataQueryForm.get("resultType"))?null:n.value)),t.xp6(1),t.Q6J("ngIf",e.dashboardData.length&&"Tables"==(null==(o=e.dataQueryForm.get("resultType"))?null:o.value))}}function H(a,s){if(1&a&&(t.TgZ(0,"ion-header",38)(1,"ion-toolbar",39)(2,"ion-menu-toggle",40),t._UZ(3,"ng-icon",41),t.qZA(),t.TgZ(4,"ion-title",42),t._uU(5),t.qZA()()()),2&a){const e=t.oxw();t.xp6(5),t.Oqu(e.title)}}function X(a,s){1&a&&(t.TgZ(0,"span",54),t._uU(1," Indicator "),t.qZA())}function tt(a,s){1&a&&(t.TgZ(0,"span"),t._uU(1," Output Indicator "),t.qZA())}function et(a,s){1&a&&(t.TgZ(0,"th"),t._uU(1," Actual Value"),t.qZA())}function at(a,s){if(1&a&&(t.TgZ(0,"tr")(1,"td",58),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"numPipe"),t.qZA()()),2&a){const e=s.$implicit;t.xp6(2),t.Oqu(e.inputLabel),t.xp6(2),t.Oqu(t.lcZ(5,2,e.inputValue))}}function ot(a,s){if(1&a&&(t.TgZ(0,"tr")(1,"td",55),t._uU(2),t.qZA(),t.TgZ(3,"td",56)(4,"table",57)(5,"tbody"),t.YNc(6,at,6,4,"tr",52),t.qZA()()()()),2&a){const e=s.$implicit;t.xp6(2),t.Oqu(null==e?null:e.outcomeIndicator),t.xp6(4),t.Q6J("ngForOf",e.outputIndicatorsInputs)}}function nt(a,s){if(1&a&&(t.TgZ(0,"td",59)(1,"div",60),t._UZ(2,"ng-icon",61),t.TgZ(3,"span",62),t._uU(4),t.qZA()()()),2&a){const e=t.oxw().$implicit;t.xp6(4),t.lnq("",null==e?null:e.sectorName," - ",null==e?null:e.lgaName," - ",null==e?null:e.lgaWard,"")}}function rt(a,s){if(1&a&&(t.TgZ(0,"td",59)(1,"div",60),t._UZ(2,"ng-icon",61),t.TgZ(3,"span",62),t._uU(4),t.qZA()()()),2&a){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e?null:e.sectorName)}}function st(a,s){if(1&a&&(t.TgZ(0,"table",48)(1,"caption"),t._uU(2),t.qZA(),t.TgZ(3,"thead",49)(4,"tr")(5,"th"),t._uU(6,"Outcome"),t.qZA(),t.TgZ(7,"th",50),t.YNc(8,X,2,0,"span",51),t.YNc(9,tt,2,0,"span",27),t.qZA(),t.YNc(10,et,2,0,"th",27),t.qZA()(),t.TgZ(11,"tbody"),t.YNc(12,ot,7,2,"tr",52),t.qZA(),t.TgZ(13,"tfoot",49)(14,"tr"),t.YNc(15,nt,5,3,"td",53),t.qZA(),t.TgZ(16,"tr"),t.YNc(17,rt,5,1,"td",53),t.qZA()()()),2&a){const e=s.$implicit,n=s.index,o=t.oxw(3);let c,u,i,d,g,v;t.xp6(2),t.hij("#",n+1,""),t.xp6(5),t.Q6J("colSpan","outputEntry"!==(null==(c=o.dataQueryForm.get("dataSource"))?null:c.value)?"2":"1"),t.xp6(1),t.Q6J("ngIf","outputEntry"!==(null==(u=o.dataQueryForm.get("dataSource"))?null:u.value)),t.xp6(1),t.Q6J("ngIf","outputEntry"==(null==(i=o.dataQueryForm.get("dataSource"))?null:i.value)),t.xp6(1),t.Q6J("ngIf","outputEntry"==(null==(d=o.dataQueryForm.get("dataSource"))?null:d.value)),t.xp6(2),t.Q6J("ngForOf",null==e?null:e.indicators),t.xp6(3),t.Q6J("ngIf","outputEntry"==(null==(g=o.dataQueryForm.get("dataSource"))?null:g.value)),t.xp6(2),t.Q6J("ngIf","outputEntry"!==(null==(v=o.dataQueryForm.get("dataSource"))?null:v.value))}}function lt(a,s){if(1&a&&(t.TgZ(0,"section",44)(1,"h2",45),t._uU(2),t.ALo(3,"uppercase"),t.qZA(),t._UZ(4,"hr",46),t.YNc(5,st,18,8,"table",47),t.qZA()),2&a){const e=s.$implicit;let n;t.xp6(2),t.Oqu(t.lcZ(3,2,null!==(n=null==e?null:e._id)&&void 0!==n?n:"")),t.xp6(3),t.Q6J("ngForOf",e.data)}}function it(a,s){if(1&a&&(t.TgZ(0,"main"),t.YNc(1,lt,6,4,"section",43),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.dashboardData)}}function ct(a,s){if(1&a&&(t.TgZ(0,"main",63),t._UZ(1,"healmah-dashboard-chart",64),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("chartData",e.chartData)}}function ut(a,s){1&a&&(t.TgZ(0,"main",65)(1,"i"),t._uU(2,"...No Data To Display..."),t.qZA()())}const M=function(){return{dateInputFormat:"DD/MM/YYYY",containerClass:"theme-blue",adaptivePosition:!0}},dt=[{path:"",component:(()=>{class a{constructor(e,n,o,c,u,i,d,g){this.router=e,this.titleService=n,this.dataTemplateService=o,this.sectorService=c,this.settingsService=u,this.toastService=i,this.dashboardService=d,this.httpClient=g,this.sDate=(0,O.Z)(new Date,7),this.eDate=(0,E.Z)(new Date,7),this.sectors=[],this.lgas=[],this.lgaWards=[],this.sumUpFields=[],this.dashboardData=[],this.chartData=[],this.dataQueryForm=new l.cw({resultType:new l.NI("Tables",l.kI.required),dataSource:new l.NI("outputEntry",l.kI.required),sector:new l.NI("",l.kI.required),lga:new l.NI(""),lgaWard:new l.NI(""),sDate:new l.NI(this.sDate,l.kI.required),eDate:new l.NI(this.eDate,l.kI.required),viewBy:new l.NI("Yearly",l.kI.required)})}ngOnInit(){this.dataQueryForm.get("lga")?.valueChanges.subscribe(e=>{this.lgaWards=this.lgas.find(n=>n?._id==e)?.wards||[],this.dataQueryForm.get("lgaWard")?.setValue("")}),this.dataQueryForm.get("dataSource")?.valueChanges.subscribe(e=>{"outputEntry"==e&&this.dataQueryForm.get("sector")?.setValue(this.sectors?.at(0)?._id),this.sumUpFields=[],this.dataQueryForm.valid&&this.processQuery()}),this.dataQueryForm.get("sector")?.valueChanges.subscribe(e=>{e&&this.dataTemplateService.getSectorDataTemplate(e).subscribe(n=>{this.sumUpFields="outcomeEntry"==this.dataQueryForm.get("dataSource")?.value?n?.outcomeIndicators?.map(o=>o?.outputIndicatorsInputs?.map(c=>c?.inputLabel))??[]:n?.outcomeOutputIndicators?.map(o=>o?.outputIndicatorsInputs?.filter(c=>"Number"==c?.inputType)?.map(c=>c?.inputLabel))??[],this.sumUpFields=this.sumUpFields?.flat()})})}ionViewDidEnter(){this.user=JSON.parse(localStorage.getItem("nix-staff")||"{}"),this.sectorService.getSectors().subscribe(e=>{this.sectors=e||[],this.sectors="All"==this.user?.sector?.sectorName?this.sectors:this.sectors?.filter(n=>n?.sectorName?.toLowerCase()==this.user?.sector?.sectorName?.toLowerCase())||[],this.sectors=this.sectors?.filter(n=>"all"!==n?.sectorName?.toLowerCase())||[]}),this.settingsService.getLgas().subscribe(e=>{this.lgas=e||[]})}processQuery(){if(!this.dataQueryForm.valid)return this.toastService.toast({type:"danger",title:"Input Error",message:p.xR.invalidForm,position:"center-center"}),void console.log(this.dataQueryForm.value);this.dashboardService.getDashboardData(this.dataQueryForm.value).subscribe(e=>{"Tables"==this.dataQueryForm.get("resultType")?.value&&(this.dashboardData=e||[]),console.log(e),"Charts"==this.dataQueryForm.get("resultType")?.value&&(this.chartData=e??[])})}exportTableData(){var e=this;return(0,y.Z)(function*(){const n={title:`Dashboard Data Export - ${(0,D.Z)(new Date(e.dashboardData.at(0)?.data.at(0)?.collectionDate),"MMM d yyy")} to ${(0,D.Z)(new Date(e.dashboardData.at(-1)?.data.at(-1)?.collectionDate),"MMM d yyy")}`,dates:e.dashboardData};try{const o=yield fetch("assets/nix/dashboard-table-template.xlsx").then(d=>d.arrayBuffer()),u=yield(yield(new w.Renderer).renderFromArrayBuffer(o,n)).xlsx.writeBuffer();(0,U.saveAs)(new Blob([u]),"dashboard-table-data.xlsx")}catch(o){console.log(o)}})()}exportChartData(){var e=this;return(0,y.Z)(function*(){const n={title:`Dashboard Data Export - ${(0,D.Z)(new Date(e.dataQueryForm.get("sDate")?.value),"MMM d yyy")} to ${(0,D.Z)(new Date(e.dataQueryForm.get("eDate")?.value),"MMM d yyy")}`,outcomes:e.chartData};console.log(n);try{const o=yield fetch("assets/nix/dashboard-chart-template.xlsx").then(d=>d.arrayBuffer()),u=yield(yield(new w.Renderer).renderFromArrayBuffer(o,n)).xlsx.writeBuffer();(0,U.saveAs)(new Blob([u]),"dashboard-chart-data.xlsx")}catch(o){console.log(o)}})()}get isBigScreen(){return window.innerWidth>=870}get title(){return this.titleService.getTitle()}static#t=this.\u0275fac=function(n){return new(n||a)(t.Y36(b.F0),t.Y36(B.Dx),t.Y36(T.t),t.Y36(A.A),t.Y36(C.g),t.Y36(h.kl),t.Y36(I),t.Y36(L.eN))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["healmah-dashboard"]],decls:54,vars:12,consts:[["contentId","main","when","(min-width:870px)"],["contentId","main","type","overlay"],["menu",""],[1,"ion-padding-start","ion-padding-top"],[1,"w:100%","bg:rgba(0,0,0,0.05)","max-h:100%","f:1rem!","mt:10px","flex","flex:column","gap:10","r:10","rr:0@<sm","p:15px",3,"formGroup"],["formControlName","resultType",1,"form-control","shadow-none"],["value","Tables"],["value","Charts"],["formControlName","dataSource",1,"form-control","shadow-none"],["value","outputEntry"],["value","outcomeEntry"],[1,"flex","gap:10"],["bsDatepicker","","formControlName","sDate",1,"form-control","form-select","shadow-none",3,"bsConfig"],["bsDatepicker","","formControlName","eDate",1,"form-control","form-select","shadow-none",3,"bsConfig"],[1,"w:50%!","mx-auto"],["formControlName","sector",1,"form-control","shadow-none"],[3,"value",4,"ngFor","ngForOf"],["class","flex gap:10 {flex:1;w:100%}>div",4,"ngIf"],["formControlName","viewBy",1,"form-control","shadow-none"],["value","Quarterly"],["value","Yearly"],["fill","solid","expand","block",3,"click"],["name","faSolidMagnifyingGlass"],["class","flex jc:center",4,"ngIf"],["id","main",1,"ion-page"],["class","height:40px! d:flex! ai:center!",4,"ngIf"],[1,"ion-padding"],[4,"ngIf"],["class","border shadow",4,"ngIf"],["class","f:2rem f:bold f:black h:100% flex ai:center jc:center",4,"ngIf"],[3,"value"],[1,"flex","gap:10","{flex:1;w:100%}>div"],["formControlName","lga",1,"form-control","shadow-none"],["value",""],["formControlName","lgaWard",1,"form-control","shadow-none"],[1,"flex","jc:center"],["class","btn btn-light shadow",3,"click",4,"ngIf"],[1,"btn","btn-light","shadow",3,"click"],[1,"height:40px!","d:flex!","ai:center!"],["color","primary",1,"height:40px!","ion-padding-horizontal","d:flex!","ai:center!"],["slot","start"],["name","faSolidBars",1,"f:white"],["color","light","slot","end"],["class","shadow mt:20 p:10 table-responsive",4,"ngFor","ngForOf"],[1,"shadow","mt:20","p:10","table-responsive"],[1,"text-center"],[1,"w:100%!","mx-auto","my:0!"],["class","table table-bordered table-striped-columns caption-top r:5! f:1rem",4,"ngFor","ngForOf"],[1,"table","table-bordered","table-striped-columns","caption-top","r:5!","f:1rem"],[1,"table-active"],[3,"colSpan"],["class","d:block text-align:center",4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","3",4,"ngIf"],[1,"d:block","text-align:center"],["colspan","1",1,"w:35%!"],["colspan","2"],[1,"table","mb:0!"],[1,"w:67%"],["colspan","3"],[1,"flex","gap:10","ai:center","jc:center"],["name","faSolidLocationDot",1,"f:blue"],[1,"opacity:0.7"],[1,"border","shadow"],[3,"chartData"],[1,"f:2rem","f:bold","f:black","h:100%","flex","ai:center","jc:center"]],template:function(n,o){if(1&n){const c=t.EpF();t.TgZ(0,"ion-split-pane",0)(1,"ion-menu",1,2)(3,"ion-content",3)(4,"form",4)(5,"div")(6,"label"),t._uU(7,"Result Type:"),t.qZA(),t.TgZ(8,"select",5)(9,"option",6),t._uU(10,"Tables"),t.qZA(),t.TgZ(11,"option",7),t._uU(12,"Charts"),t.qZA()()(),t.TgZ(13,"div")(14,"label"),t._uU(15,"Data Source:"),t.qZA(),t.TgZ(16,"select",8)(17,"option",9),t._uU(18,"Outputs"),t.qZA(),t.TgZ(19,"option",10),t._uU(20,"Outcomes"),t.qZA()()(),t.TgZ(21,"div",11)(22,"div")(23,"label"),t._uU(24,"Start Date:"),t.qZA(),t._UZ(25,"input",12),t.qZA(),t.TgZ(26,"div")(27,"label"),t._uU(28,"End Date:"),t.qZA(),t._UZ(29,"input",13),t.qZA()(),t._UZ(30,"hr",14),t.TgZ(31,"div")(32,"label"),t._uU(33,"Sector:"),t.qZA(),t.TgZ(34,"select",15),t.YNc(35,R,2,2,"option",16),t.qZA()(),t.YNc(36,V,15,2,"div",17),t.TgZ(37,"div")(38,"label"),t._uU(39,"View By:"),t.qZA(),t.TgZ(40,"select",18)(41,"option",19),t._uU(42,"Quarterly"),t.qZA(),t.TgZ(43,"option",20),t._uU(44,"Yearly"),t.qZA()()(),t.TgZ(45,"ion-button",21),t.NdJ("click",function(){return o.processQuery()})("click",function(){t.CHM(c);const i=t.MAs(2);return t.KtG(null==i?null:i.close())}),t._UZ(46,"ng-icon",22),t.qZA(),t.YNc(47,z,3,2,"div",23),t.qZA()()(),t.TgZ(48,"div",24),t.YNc(49,H,6,1,"ion-header",25),t.TgZ(50,"ion-content",26),t.YNc(51,it,2,1,"main",27),t.YNc(52,ct,2,1,"main",28),t.YNc(53,ut,3,0,"main",29),t.qZA()()()}if(2&n){let c,u,i;t.xp6(4),t.Q6J("formGroup",o.dataQueryForm),t.xp6(21),t.Q6J("bsConfig",t.DdM(10,M)),t.xp6(4),t.Q6J("bsConfig",t.DdM(11,M)),t.xp6(6),t.Q6J("ngForOf",o.sectors),t.xp6(1),t.Q6J("ngIf","outputEntry"==(null==(c=o.dataQueryForm.get("dataSource"))?null:c.value)),t.xp6(11),t.Q6J("ngIf",o.chartData.length||o.dashboardData.length),t.xp6(2),t.Q6J("ngIf",!o.isBigScreen),t.xp6(2),t.Q6J("ngIf",(null==o.dashboardData?null:o.dashboardData.length)&&"Tables"==(null==(u=o.dataQueryForm.get("resultType"))?null:u.value)),t.xp6(1),t.Q6J("ngIf",(null==o.chartData?null:o.chartData.length)&&"Charts"==(null==(i=o.dataQueryForm.get("resultType"))?null:i.value)),t.xp6(1),t.Q6J("ngIf",!(null!=o.dashboardData&&o.dashboardData.length||o.chartData.length))}},dependencies:[F.sg,F.O5,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.sg,l.u,j.Fv,m.YG,m.W2,m.Gu,m.z0,m.zc,m.jI,m.wd,m.sr,Y.Np,Y.Y5,$,F.gd,W.i],styles:["select.multiple[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}"]})}return a})()}];let pt=(()=>{class a{static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275mod=t.oAB({type:a});static#a=this.\u0275inj=t.cJS({imports:[b.Bz.forChild(dt),b.Bz]})}return a})(),ht=(()=>{class a{static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275mod=t.oAB({type:a});static#a=this.\u0275inj=t.cJS({imports:[f._o,f.Nu,S.Ns.forRoot({echarts:()=>r.e(1701).then(r.bind(r,1701))}),pt]})}return a})()},5866:(q,x,r)=>{r.d(x,{Z:()=>l});var b=r(1998),y=r(953),T=r(833);function l(A,C){(0,T.Z)(2,arguments);var h=(0,y.Z)(A),p=(0,b.Z)(C);if(isNaN(p))return new Date(NaN);if(!p)return h;var f=h.getDate(),t=new Date(h.getTime());return t.setMonth(h.getMonth()+p+1,0),f>=t.getDate()?t:(h.setFullYear(t.getFullYear(),t.getMonth(),f),h)}}}]);