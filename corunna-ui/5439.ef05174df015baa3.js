"use strict";(self.webpackChunkcorunna_ui=self.webpackChunkcorunna_ui||[]).push([[5439],{5439:(E,h,i)=>{i.r(h),i.d(h,{ExpenditurePageModule:()=>F});var g=i(9595),c=i(5861),x=i(1038),y=i(9808),d=i(4850),p=i(9063),e=i(4650);let b=(()=>{class n extends d.q2{constructor(){super(p.ih.Setting,"dvt",!0)}saveExpenditure(t){return this.post({payload:t,endPoint:[p.yv.settingsStore,p.yv.expenditure]})}getExpenses(t,o,r){return this.get({endPoint:[p.wm.settingsQuery,p.yv.expenditure],params:[{k:"sDate",v:JSON.stringify(t)},{k:"eDate",v:JSON.stringify(o)},{k:"shopBranch",v:r}]})}deleteExpenditure(t){return this.delete({endPoint:[p.yv.settingsStore,p.yv.expenditure],payload:t})}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var A=i(4715),T=i(5115),s=i(8118),a=i(4006),_=i(2958),m=i(6895),M=i(6726),N=i(2216),Z=i(9492);function S(n,f){if(1&n&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&n){const t=f.$implicit;e.Q6J("value",t.branchName),e.xp6(1),e.Oqu(t.branchName)}}function B(n,f){if(1&n){const t=e.EpF();e.TgZ(0,"select",17),e.NdJ("ngModelChange",function(r){e.CHM(t);const l=e.oxw();return e.KtG(l.shopBranch=r)}),e.TgZ(1,"option",18),e._uU(2,"All"),e.qZA(),e.YNc(3,S,2,2,"option",19),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngModel",t.shopBranch),e.xp6(1),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",t.shopBranches)}}function D(n,f){if(1&n){const t=e.EpF();e.TgZ(0,"ion-col",20)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-subtitle",21)(4,"ion-label"),e._uU(5),e.ALo(6,"date"),e._UZ(7,"br"),e.TgZ(8,"span",22),e._uU(9),e.qZA()(),e.TgZ(10,"ion-label",23)(11,"fa-icon",24),e.NdJ("click",function(){const l=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.deleteExpense(l))}),e.qZA()()(),e.TgZ(12,"ion-card-title",25),e._uU(13),e.ALo(14,"number"),e.qZA()(),e.TgZ(15,"ion-card-content")(16,"p",26)(17,"label",27),e._uU(18,"Remark:"),e.qZA(),e._UZ(19,"br"),e._uU(20),e.qZA(),e.TgZ(21,"ion-title",28),e._uU(22),e.qZA()()()()}if(2&n){const t=f.$implicit;e.xp6(5),e.hij(" ",e.xi3(6,6,null==t?null:t.expenseDate,"medium")," "),e.xp6(4),e.Oqu(null==t||null==t.shopBranch?null:t.shopBranch.branchName),e.xp6(4),e.Oqu(e.lcZ(14,9,t.expenseAmount)),e.xp6(7),e.hij(" ",null==t?null:t.expenseRemark," "),e.xp6(2),e.AsE("by: ",null==t||null==t.userAccount?null:t.userAccount.firstName," ",null==t||null==t.userAccount?null:t.userAccount.surName,"")}}function P(n,f){if(1&n&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&n){const t=f.$implicit;e.Q6J("value",t.branchName),e.xp6(1),e.Oqu(t.branchName)}}const v=function(){return{dateInputFormat:"DD/MM/YYYY",containerClass:"theme-blue",adaptivePosition:!0}};function J(n,f){if(1&n){const t=e.EpF();e.TgZ(0,"ion-header",29)(1,"ion-toolbar",30)(2,"h3",31),e._uU(3," Create "),e.qZA()()(),e.TgZ(4,"ion-content",4)(5,"form",32)(6,"section",33)(7,"div")(8,"label"),e._uU(9,"Spent On:"),e.qZA(),e._UZ(10,"input",34),e.qZA(),e.TgZ(11,"div",35)(12,"label"),e._uU(13,"Branch Name:"),e.qZA(),e.TgZ(14,"select",36),e.YNc(15,P,2,2,"option",19),e.qZA()(),e.TgZ(16,"div")(17,"label"),e._uU(18,"Amount Spent:"),e.qZA(),e._UZ(19,"input",37),e.qZA(),e.TgZ(20,"div")(21,"label"),e._uU(22,"Expense Remark:"),e.qZA(),e._UZ(23,"input",38),e.qZA(),e.TgZ(24,"div",39)(25,"ion-button",40),e.NdJ("handle",function(r){e.CHM(t);const l=e.oxw();return e.KtG(l.saveResult(r))}),e._uU(26," Save "),e.qZA(),e.TgZ(27,"ion-button",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.expenditureForm.reset())}),e._uU(28," Reset "),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("formGroup",t.expenditureForm),e.xp6(5),e.Q6J("bsConfig",e.DdM(4,v)),e.xp6(5),e.Q6J("ngForOf",t.shopBranches),e.xp6(10),e.Q6J("handler",t.handler)}}const C=function(){return[0,.65,.75,.85]},w=[{path:"",component:(()=>{class n{constructor(t,o,r,l){this.settingsService=t,this.dialogService=o,this.localStorageService=r,this.expenditureService=l,this.shopBranches=[],this.expenditures=[],this.sDate=(0,x.Z)(new Date,3),this.eDate=new Date,this.shopBranch=null,this.handler=u=>this.expenditureForm.invalid?(_.F.show({text:p.xR.invalidForm,duration:"long",position:"bottom"}),Promise.resolve()):this.expenditureService.saveExpenditure(this.expenditureForm.value),this.expenditureForm=new a.cw({expenseAmount:new a.NI(null,a.kI.required),expenseDate:new a.NI(new Date,a.kI.required),expenseRemark:new a.NI(null,a.kI.required),shopBranch:new a.NI(null,a.kI.required)})}ngOnInit(){this.staff=JSON.parse(this.localStorageService.get("staff-profile")||"{}"),this.getExpenditures(),this.getShopBranches()}ionViewDidEnter(){this.modal?.didPresent.subscribe(()=>{const t={expenseModal:!0,desc:"fake state for our modal"};history.state.expenseModal?history.replaceState(t,null):history.pushState(t,null)}),this.modal.onWillDismiss().then(()=>{history.state.expenseModal&&history.back()})}ngOnDestroy(){this.modal?.dismiss(),history.state.expenseModal&&history.back()}closeModal(){this.modal?.dismiss()}getShopBranches(){this.settingsService.getShopBranches().subscribe(t=>{this.shopBranches="Super"==this.staff.acctType?t:t.filter(o=>o.branchName==this.staff.shopBranch?.branchName)})}getExpenditures(t){this.expenditureService.getExpenses(this.sDate,this.eDate,"Super"!==this.staff.acctType?this.staff.shopBranch?.branchName:this.shopBranch).subscribe(o=>{t&&t.target.complete(),Array.isArray(o)&&(this.expenditures=o)})}deleteExpense(t){var o=this;return(0,c.Z)(function*(){(yield(0,y.n)(o.dialogService.openConfirmDialog({title:"Action Confirmation",message:"Are you sure to delete this expenditure record?"})))&&o.expenditureService.deleteExpenditure(t._id).subscribe(l=>{l?._id&&(o.getExpenditures(),_.F.show({text:"Expenditure record "+p.kt.itemDeleted,duration:"long"}))})})()}saveResult(t){var o=this;return(0,c.Z)(function*(){t?._id&&(yield _.F.show({text:"Expenditure saved successfully",duration:"long",position:"top"}),o.expenditureForm.reset(),o.getExpenditures())})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(A.g),e.Y36(T.xA),e.Y36(d.n2),e.Y36(b))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["healmah-expenditure"]],viewQuery:function(o,r){if(1&o&&e.Gf(s.ki,7),2&o){let l;e.iGM(l=e.CRH())&&(r.modal=l.first)}},hostBindings:function(o,r){1&o&&e.NdJ("popstate",function(u){return r.closeModal(u)},!1,e.Jf7)},decls:22,vars:13,consts:[["color","primary"],["slot","start"],["color","light",3,"defaultHref"],["slot","start","color","light"],[1,"ion-padding"],["slot","fixed",3,"ionRefresh"],[1,"d:flex","gap:10","mt:20"],["type","text","bsDatepicker","","container","body",1,"form-control","flex:1","shadow:none!",3,"bsConfig","ngModel","ngModelChange"],["class","form-control form-select shadow:none! flex-basis:70!",3,"ngModel","ngModelChange",4,"ngIf"],[3,"fixed"],[1,"p:0!"],["size","12","class","p:0!",4,"ngFor","ngForOf"],["trigger","open-expense-modal","sheetModal","","handleBehavior","cycle",3,"initialBreakpoint","breakpoints"],["modal",""],["vertical","top","horizontal","start","slot","fixed"],["color","primary","id","open-expense-modal"],["name","add-outline"],[1,"form-control","form-select","shadow:none!","flex-basis:70!",3,"ngModel","ngModelChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["size","12",1,"p:0!"],[1,"flex","jc:space-between"],[1,"f:1.2rem","f:bold"],[1,"d:flex","gap:20"],["icon","trash-alt",1,"text-danger",3,"click"],["color","primary",1,"f:2rem!","text-align:center!"],[1,"f:f:1.2rem!"],[1,"text-primary"],[1,"text-align:center!","f:0.8rem!"],[1,"ion-no-border"],["color","tertiary"],[1,"flex","jc:center","px:20","f:black!"],[3,"formGroup"],[1,"flex","flex:column","gap:15"],["type","text","bsDatepicker","","container","body","formControlName","expenseDate",1,"form-control","shadow:none!",3,"bsConfig"],[1,""],["formControlName","shopBranch",1,"form-control","form-select","shadow:none!!"],["type","number","formControlName","expenseAmount",1,"form-control"],["type","text","placeholder","e.g use for ...","formControlName","expenseRemark",1,"form-control"],[1,"flex","gap:20","mt:20","{flex:1}>.btn"],["btnDisabler","","expand","block","fill","solid","shape","round",1,"w-100",3,"handler","handle"],["expand","block","color","warning","fill","solid","shape","round",1,"w-100",3,"click"]],template:function(o,r){1&o&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title",3),e._uU(5,"Expenditure"),e.qZA()()(),e.TgZ(6,"ion-content",4)(7,"ion-refresher",5),e.NdJ("ionRefresh",function(u){return r.getExpenditures(u)}),e._UZ(8,"ion-refresher-content"),e.qZA(),e.TgZ(9,"header",6)(10,"input",7),e.NdJ("ngModelChange",function(u){return r.sDate=u}),e.qZA(),e.TgZ(11,"input",7),e.NdJ("ngModelChange",function(u){return r.eDate=u}),e.qZA(),e.YNc(12,B,4,3,"select",8),e.qZA(),e.TgZ(13,"ion-grid",9)(14,"ion-row",10),e.YNc(15,D,23,11,"ion-col",11),e.qZA()(),e.TgZ(16,"ion-modal",12,13),e.YNc(18,J,29,5,"ng-template"),e.qZA(),e.TgZ(19,"ion-fab",14)(20,"ion-fab-button",15),e._UZ(21,"ion-icon",16),e.qZA()()()),2&o&&(e.xp6(3),e.Q6J("defaultHref",null==r.staff||null==r.staff.acctType?null:r.staff.acctType.toLowerCase()),e.xp6(7),e.Q6J("bsConfig",e.DdM(10,v))("ngModel",r.sDate),e.xp6(1),e.Q6J("bsConfig",e.DdM(11,v))("ngModel",r.eDate),e.xp6(1),e.Q6J("ngIf","Super"==(null==r.staff?null:r.staff.acctType)),e.xp6(1),e.Q6J("fixed",!0),e.xp6(2),e.Q6J("ngForOf",r.expenditures),e.xp6(1),e.Q6J("initialBreakpoint",.65)("breakpoints",e.DdM(12,C)))},dependencies:[m.sg,m.O5,a._Y,a.YN,a.Kr,a.Fj,a.wV,a.EJ,a.JJ,a.JL,a.On,a.sg,a.u,M.h,s.YG,s.Sm,s.PM,s.FN,s.Zi,s.tO,s.Dq,s.wI,s.W2,s.IJ,s.W4,s.jY,s.Gu,s.gu,s.Q$,s.nJ,s.Wo,s.Nd,s.wd,s.sr,s.ki,s.oU,N.BN,Z.Np,Z.Y5,m.JJ,m.uU],styles:["[_nghost-%COMP%]{--ion-color-primary: #EA6D35;--ion-color-primary-rgb: 56, 128, 255;--ion-color-primary-contrast: #ffffff;--ion-color-primary-contrast-rgb: 255, 255, 255;--ion-color-primary-shade: #3171e0;--ion-color-primary-tint: #4c8dff;--ion-color-secondary: #1A2031;--ion-color-secondary-rgb: 61, 194, 255;--ion-color-secondary-contrast: #ffffff;--ion-color-secondary-contrast-rgb: 255, 255, 255;--ion-color-secondary-shade: #36abe0;--ion-color-secondary-tint: #50c8ff;--ion-color-tertiary: #F4E9E9;--ion-color-tertiary-rgb: 82, 96, 255;--ion-color-tertiary-contrast: #ffffff;--ion-color-tertiary-contrast-rgb: 255, 255, 255;--ion-color-tertiary-shade: #4854e0;--ion-color-tertiary-tint: #6370ff;--ion-color-success: #2dd36f;--ion-color-success-rgb: 45, 211, 111;--ion-color-success-contrast: #ffffff;--ion-color-success-contrast-rgb: 255, 255, 255;--ion-color-success-shade: #28ba62;--ion-color-success-tint: #42d77d;--ion-color-warning: #ffc409;--ion-color-warning-rgb: 255, 196, 9;--ion-color-warning-contrast: #000000;--ion-color-warning-contrast-rgb: 0, 0, 0;--ion-color-warning-shade: #e0ac08;--ion-color-warning-tint: #ffca22;--ion-color-danger: #eb445a;--ion-color-danger-rgb: 235, 68, 90;--ion-color-danger-contrast: #ffffff;--ion-color-danger-contrast-rgb: 255, 255, 255;--ion-color-danger-shade: #cf3c4f;--ion-color-danger-tint: #ed576b;--ion-color-dark: #222428;--ion-color-dark-rgb: 34, 36, 40;--ion-color-dark-contrast: #ffffff;--ion-color-dark-contrast-rgb: 255, 255, 255;--ion-color-dark-shade: #1e2023;--ion-color-dark-tint: #383a3e;--ion-color-medium: #f3f3f3;--ion-color-medium-rgb: 146, 148, 156;--ion-color-medium-contrast: #ffffff;--ion-color-medium-contrast-rgb: 255, 255, 255;--ion-color-medium-shade: #808289;--ion-color-medium-tint: #9d9fa6;--ion-color-light: #f4f5f8;--ion-color-light-rgb: 244, 245, 248;--ion-color-light-contrast: #000000;--ion-color-light-contrast-rgb: 0, 0, 0;--ion-color-light-shade: #d7d8da;--ion-color-light-tint: #f5f6f9}"]})}return n})()}];let U=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#n=this.\u0275inj=e.cJS({imports:[g.Bz.forChild(w),g.Bz]})}return n})(),F=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#n=this.\u0275inj=e.cJS({imports:[d._o,d.Nu,U]})}return n})()},4715:(E,h,i)=>{i.d(h,{g:()=>y});var g=i(4850),c=i(9063),x=i(4650);let y=(()=>{class d extends g.q2{constructor(){super(c.ih.Setting,"dvt",!0)}saveShopBranch(e){return this.post({endPoint:[c.yv.settingsStore,c.yv.shopBranch],payload:e})}assignToShop(e){return this.put({endPoint:[c.yv.settingsStore,c.yv.shopBranch],payload:e})}getShopBranches(){return this.get({endPoint:[c.wm.settingsQuery,c.wm.shopBranch]})}deleteShopBranch(e){return this.delete({payload:e,endPoint:[c.yv.settingsStore,c.yv.shopBranch]})}static#e=this.\u0275fac=function(b){return new(b||d)};static#t=this.\u0275prov=x.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()}}]);