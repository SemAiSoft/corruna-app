"use strict";(self.webpackChunkcorunna_ui=self.webpackChunkcorunna_ui||[]).push([[6027],{6027:(b,h,o)=>{o.r(h),o.d(h,{RenderServicePageModule:()=>J});var f=o(9595),a=o(5861),y=o(7625),n=o(4006),m=o(1067),S=o(9063),u=o(5115),v=o(2958),T=o(2039),e=o(4650),I=o(8398),C=o(2412),d=o(8118),g=o(6895),P=o(6726),N=o(2216),x=o(1191);function F(s,p){if(1&s){const r=e.EpF();e.TgZ(0,"div")(1,"div",29)(2,"div",30)(3,"label"),e._uU(4,"Service:"),e.qZA(),e.TgZ(5,"input",31),e.NdJ("typeaheadOnSelect",function(t){const c=e.CHM(r).index,A=e.MAs(10);return e.oxw().serviceSelected(t,c),e.KtG(A.focus())}),e.qZA()(),e.TgZ(6,"div",32)(7,"label"),e._uU(8,"x:"),e.qZA(),e.TgZ(9,"input",33,34),e.NdJ("input",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.numOfTimesChanged())}),e.qZA()(),e.TgZ(11,"div",35)(12,"label"),e._uU(13,"PM:"),e.qZA(),e.TgZ(14,"select",36)(15,"option",37),e._uU(16,"Cash"),e.qZA(),e.TgZ(17,"option",38),e._uU(18,"Bank"),e.qZA()()(),e.TgZ(19,"fa-icon",39),e.NdJ("click",function(){const l=e.CHM(r).index,c=e.oxw();return e.KtG(c.removeServiceItem(l))}),e.qZA()()()}if(2&s){const r=p.index,i=e.oxw();e.xp6(1),e.Q6J("formGroupName",r),e.xp6(4),e.Q6J("typeahead",i.services)("typeaheadOptionsLimit",15)}}function O(s,p){if(1&s){const r=e.EpF();e.TgZ(0,"button",40),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.printInvoice())}),e._UZ(1,"fa-icon",41),e.qZA()}}function R(s,p){if(1&s&&(e.TgZ(0,"tr",42)(1,"td",43),e._uU(2),e.qZA(),e.TgZ(3,"td",43),e._uU(4),e.ALo(5,"number"),e.qZA(),e.TgZ(6,"td",43),e._uU(7),e.ALo(8,"number"),e.qZA(),e.TgZ(9,"td",43),e._uU(10),e.qZA(),e.TgZ(11,"td",43),e._uU(12),e.ALo(13,"number"),e.ALo(14,"number"),e.qZA()()),2&s){const r=p.$implicit;e.xp6(2),e.hij(" ",null==r?null:r.serviceName," "),e.xp6(2),e.hij(" ",e.lcZ(5,7,null==r?null:r.serviceCost)," "),e.xp6(3),e.AsE(" ",e.lcZ(8,9,null==r?null:r.commissionAmount)," (",null==r?null:r.serviceCommission,"%) "),e.xp6(3),e.hij(" ",null==r?null:r.numOfTimes," "),e.xp6(2),e.AsE(" ",e.lcZ(13,11,((null==r?null:r.serviceCost)||1)*((null==r?null:r.numOfTimes)||1))," ~ ",e.lcZ(14,13,((null==r?null:r.commissionAmount)||1)*((null==r?null:r.numOfTimes)||1))," ")}}const U=[{path:"",component:(()=>{class s{constructor(r,i,t,l,c,A,_,w){this.toastService=r,this.servicesService=i,this.localStorageService=t,this.userAccountService=l,this.platform=c,this.systemConfigService=A,this.printerService=_,this.router=w,this.services=[],this.staffAccounts=[],this.serviceBy={},this.totalAmount=0,this.process=E=>this.serviceRenderForm.invalid||!this.serviceBy?._id?(v.F.show({text:S.xR.invalidForm,duration:"long",position:"top"}),Promise.resolve()):this.servicesService.renderService(this.serviceRenderForm.value,this.serviceBy),this.serviceRenderForm=new n.cw({serviceItems:new n.Oe([this.serviceItemGroup()]),renderedBy:new n.NI(null,[n.kI.required,n.kI.min(1)])})}ionViewDidEnter(){this.resetForm(),this.staffAccounts=[],this.staff=JSON.parse(this.localStorageService.get("staff-profile")||"{}"),this.servicesService.serviceToPrint=null,this.servicesService.getServices().subscribe(r=>{this.services=r.map(i=>({serviceName:i.serviceName,serviceCommission:i.serviceCommission,serviceCost:i.serviceCost,display:i.serviceName+" ("+i.serviceCost+" ~ "+i?.serviceCommission+"%)"}))}),this.userAccountService.getAccounts().subscribe(r=>{r?.length&&r?.filter(i=>"Standard"!==i.acctType).forEach(i=>{this.staffAccounts.push({_id:i._id,userName:i.firstName+" "+i.surName})})})}serviceItemGroup(r){return new n.cw({serviceName:new n.NI(null,n.kI.required),serviceCost:new n.NI(null,[n.kI.required,n.kI.min(1)]),serviceCommission:new n.NI(null,[n.kI.required,n.kI.min(1)]),commissionAmount:new n.NI(null,[n.kI.required,n.kI.min(1)]),payMethod:new n.NI("Cash",n.kI.required),numOfTimes:new n.NI(1,[n.kI.required,n.kI.min(1)])})}get serviceItemArr(){return this.serviceRenderForm.get("serviceItems")}addServiceItem(){this.serviceItemArr.controls.at(0)?.get("serviceName")?.valid&&this.serviceItemArr.controls.at(0)?.get("numOfTimes")?.valid&&this.serviceItemArr.insert(0,this.serviceItemGroup())}removeServiceItem(r){this.serviceItemArr.length>1&&(this.serviceItemArr.removeAt(r),this.totalAmount=this.serviceItemArr.controls.reduce((i,t)=>i+parseFloat(t.get("serviceCost")?.value)*parseFloat(t.get("numOfTimes")?.value),0))}serviceSelected(r,i){const t=r.item;if(this.serviceItemArr.controls.filter(l=>l.get("serviceName")?.value==t.serviceName).length>=1)return this.serviceItemArr.controls.at(i)?.get("serviceName")?.reset(),void v.F.show({text:"Service already selected, please choose another",position:"bottom",duration:"long"});this.serviceItemArr.at(i)?.get("serviceName")?.setValue(t.serviceName),this.serviceItemArr.at(i)?.get("serviceCost")?.setValue(t.serviceCost),this.serviceItemArr.at(i)?.get("serviceCommission")?.setValue(t.serviceCommission),this.serviceItemArr.at(i)?.get("commissionAmount")?.setValue(t?.serviceCommission/100*t?.serviceCost||1),this.totalAmount=this.serviceItemArr.controls.reduce((l,c)=>l+parseFloat(c.get("serviceCost")?.value)*parseFloat(c.get("numOfTimes")?.value),0)}serviceByChange(r){this.serviceBy=r.item}numOfTimesChanged(){this.totalAmount=this.serviceItemArr.controls.reduce((r,i)=>r+parseFloat(i.get("serviceCost")?.value)*parseFloat(i.get("numOfTimes")?.value),0)}processService(){var r=this;return(0,a.Z)(function*(){!r.serviceRenderForm.invalid&&r.serviceBy?._id?r.servicesService.renderService(r.serviceRenderForm.value,r.serviceBy).subscribe(function(){var i=(0,a.Z)(function*(t){t?._id&&(r.serviceRenderForm.reset(),r.serviceBy=null,r.servicesService.serviceToPrint=t,r.servicesService.updateReport.next(!0),yield v.F.show({text:S.kt.formSaved,duration:"long",position:"top"}))});return function(t){return i.apply(this,arguments)}}()):yield v.F.show({text:S.xR.invalidForm,duration:"long",position:"top"})})()}result(r){var i=this;return(0,a.Z)(function*(){r?._id&&(yield v.F.show({text:"Sale processed successfully",duration:"long",position:"top"}),i.servicesService.serviceToPrint=r,i.servicesService.updateReport.next(!0),i.resetForm())})()}resetForm(){this.serviceRenderForm.reset(),this.serviceItemArr.clear(),this.serviceItemArr.insert(0,this.serviceItemGroup()),this.totalAmount=0}printInvoice(){var r=this;return(0,a.Z)(function*(){yield r.printerService.printSectionToBle(r.servicesService.serviceToPrint,r.systemConfigService.systemConfig.printType,"print-section-admin")})()}closeModal(){this.router.navigate(["Super"==this.staff.acctType?"/super/hair-home":this.staff.acctType?.toLowerCase()])}static#e=this.\u0275fac=function(i){return new(i||s)(e.Y36(u.kl),e.Y36(m.r),e.Y36(I.n),e.Y36(y.N),e.Y36(C.t4),e.Y36(T.c),e.Y36(u.vP),e.Y36(f.F0))};static#r=this.\u0275cmp=e.Xpm({type:s,selectors:[["healmah-render-service"]],hostBindings:function(i,t){1&i&&e.NdJ("popstate",function(c){return t.closeModal(c)},!1,e.Jf7)},decls:66,vars:24,consts:[["color","secondary"],["slot","start"],["color","light",3,"defaultHref"],["color","light","slot","end"],["color","primary",1,"ion-padding"],[1,"p:10","flex","my:40","flex:column","gap:10","{flex;flex:column;gap:15}>div","{f:white}_label","{b:#0F85E9!}_input","{b:#0F85E9!}_select","print-none",3,"formGroup"],["formArrayName","serviceItems"],[4,"ngFor","ngForOf"],[1,"f:blue"],[1,"d:flex!","flex-direction:column!","gap:15!"],["formControlName","renderedBy","type","text","typeaheadOptionField","userName",1,"form-control",3,"typeahead","typeaheadOnSelect"],[1,"text-center","f:white","f:bold","mt:25"],[1,"text-decoration-line-through","text-decoration-style:double"],["btnDisabler","",1,"btn","btn-outline-primary","mt:25",3,"handler","disableWhenProcessing","handle"],[1,"btn","btn-outline-warning","mt:25",3,"click"],["class","btn btn-outline-secondary mt:10",3,"click",4,"ngIf"],["id","print-section-admin",1,"w:100vw","f:black!","d:none","display:block@print","{text-align:center}>h2","{text-align:center}>h4","{text-align:center}>h6"],[2,"text-align","center","margin","0"],[2,"text-align","center","margin","0","font-family","monospace"],[2,"text-align","center"],[1,"f:beryl-1"],[1,"table","table-striped","table-bordered",2,"border","1px solid lightgray","width","100%"],[2,"caption-side","bottom","text-align","center","padding","10px"],["style","padding: 10px;",4,"ngFor","ngForOf"],["colspan","3"],["colspan","2"],["slot","fixed","vertical","top","horizontal","start"],["color","secondary","size","small",3,"click"],["name","add"],[1,"flex","gap:3",3,"formGroupName"],[1,"mt:10","flex:1"],["type","text","formControlName","serviceName","typeaheadOptionField","display","container","body",1,"form-control","rr:0!",3,"typeahead","typeaheadOptionsLimit","typeaheadOnSelect"],[1,"mt:10","flex-basis:35px"],["type","number","formControlName","numOfTimes",1,"form-control","rl:0!","rr:0!","px:0","pl:5!",3,"input"],["qtty",""],[1,"mt:10","flex-basis:55px"],["formControlName","payMethod",1,"form-control","form-select","pl:5!","rl:0!","rr:0!"],["value","Cash"],["value","Bank"],["icon","minus",1,"btn","btn-outline-warning","align-self-end","rl:0!",3,"click"],[1,"btn","btn-outline-secondary","mt:10",3,"click"],["icon","print"],[2,"padding","10px"],[2,"padding","10px","border-bottom","1px solid lightgray","border-right","1px solid lightgray"]],template:function(i,t){if(1&i&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title",3),e._uU(5,"Render Service"),e.qZA()()(),e.TgZ(6,"ion-content",4)(7,"form",5)(8,"div",6),e.YNc(9,F,20,3,"div",7),e.qZA(),e._UZ(10,"hr",8),e.TgZ(11,"div",9)(12,"div")(13,"label"),e._uU(14,"Rendered by:"),e.qZA(),e.TgZ(15,"input",10),e.NdJ("typeaheadOnSelect",function(c){return t.serviceByChange(c)}),e.qZA()(),e.TgZ(16,"h1",11),e._uU(17," Total: "),e.TgZ(18,"span",12),e._uU(19,"N"),e.qZA(),e._uU(20),e.qZA(),e.TgZ(21,"button",13),e.NdJ("handle",function(c){return t.result(c)}),e._uU(22,"Process "),e.qZA(),e.TgZ(23,"button",14),e.NdJ("click",function(){return t.resetForm()}),e._uU(24,"Reset"),e.qZA(),e.YNc(25,O,2,0,"button",15),e.qZA()(),e.TgZ(26,"div",16)(27,"h1",17),e._uU(28,"RICHMOND"),e.qZA(),e.TgZ(29,"h2",18),e._uU(30,"Beauty & Hair Studio"),e.qZA(),e.TgZ(31,"p",19),e._uU(32,"Shop 51 - IBB MALL, Shiroro Road, Tunga Minna"),e.qZA(),e.TgZ(33,"h4",17)(34,"span"),e._uU(35),e.ALo(36,"uppercase"),e.qZA()(),e._UZ(37,"hr",20),e.TgZ(38,"table",21)(39,"caption",22),e._uU(40),e.ALo(41,"date"),e.qZA(),e.TgZ(42,"thead")(43,"tr")(44,"th"),e._uU(45,"SERVICE"),e.qZA(),e.TgZ(46,"th"),e._uU(47,"COST"),e.qZA(),e.TgZ(48,"th"),e._uU(49,"COM"),e.qZA(),e.TgZ(50,"th"),e._uU(51,"TIMES"),e.qZA(),e.TgZ(52,"th"),e._uU(53,"TOT"),e.qZA()()(),e.TgZ(54,"tbody"),e.YNc(55,R,15,15,"tr",23),e.qZA(),e.TgZ(56,"tfoot")(57,"th",24),e._uU(58),e.ALo(59,"number"),e.qZA(),e.TgZ(60,"th",25),e._uU(61),e.ALo(62,"number"),e.qZA()()()(),e.TgZ(63,"ion-fab",26)(64,"ion-fab-button",27),e.NdJ("click",function(){return t.addServiceItem()}),e._UZ(65,"ion-icon",28),e.qZA()()()),2&i){let l,c;e.xp6(3),e.Q6J("defaultHref",null==t.staff||null==t.staff.acctType?null:t.staff.acctType.toLowerCase()),e.xp6(4),e.Q6J("formGroup",t.serviceRenderForm),e.xp6(2),e.Q6J("ngForOf",null==t.serviceItemArr?null:t.serviceItemArr.controls),e.xp6(6),e.Q6J("typeahead",t.staffAccounts),e.xp6(5),e.hij("",t.totalAmount," "),e.xp6(1),e.Q6J("handler",t.process)("disableWhenProcessing",!0),e.xp6(4),e.Q6J("ngIf",null==t.servicesService?null:t.servicesService.serviceToPrint),e.xp6(10),e.AsE("",e.lcZ(36,15,"Staff Service Invoice")," #",null==t.servicesService||null==t.servicesService.serviceToPrint?null:t.servicesService.serviceToPrint.invoiceId,""),e.xp6(5),e.AsE(" WELL DONE, ",(null==t.servicesService||null==t.servicesService.serviceToPrint||null==t.servicesService.serviceToPrint.renderedBy?null:t.servicesService.serviceToPrint.renderedBy.firstName)+" "+(null==t.servicesService||null==t.servicesService.serviceToPrint||null==t.servicesService.serviceToPrint.renderedBy?null:t.servicesService.serviceToPrint.renderedBy.surName)," @ ",e.xi3(41,17,null==t.servicesService||null==t.servicesService.serviceToPrint?null:t.servicesService.serviceToPrint.createdAt,"LLL M, yyyy - h:mma")," "),e.xp6(15),e.Q6J("ngForOf",null==t.servicesService||null==t.servicesService.serviceToPrint?null:t.servicesService.serviceToPrint.serviceItems),e.xp6(3),e.hij("Total Cost: ",e.lcZ(59,20,null==(l=t.servicesService.serviceToPrintTotals(null==t.servicesService?null:t.servicesService.serviceToPrint))?null:l.totalCost),""),e.xp6(3),e.hij("Total Commission: ",e.lcZ(62,22,null==(c=t.servicesService.serviceToPrintTotals(null==t.servicesService?null:t.servicesService.serviceToPrint))?null:c.totalCommission),"")}},dependencies:[g.sg,g.O5,n._Y,n.YN,n.Kr,n.Fj,n.wV,n.EJ,n.JJ,n.JL,n.sg,n.u,n.x0,n.CE,P.h,d.Sm,d.W2,d.IJ,d.W4,d.Gu,d.gu,d.wd,d.sr,d.oU,N.BN,x.Bp,g.gd,g.JJ,g.uU],styles:["[_nghost-%COMP%]{--ion-color-primary: #333B46;--ion-color-primary-rgb: 56, 128, 255;--ion-color-primary-contrast: #ffffff;--ion-color-primary-contrast-rgb: 255, 255, 255;--ion-color-primary-shade: #333B46;--ion-color-primary-tint: #333B46;--ion-color-secondary: #1F2630;--ion-color-secondary-rgb: 61, 194, 255;--ion-color-secondary-contrast: #ffffff;--ion-color-secondary-contrast-rgb: 255, 255, 255;--ion-color-secondary-shade: #1F2630;--ion-color-secondary-tint: #1F2630;--ion-color-tertiary: #f3f3f3;--ion-color-tertiary-rgb: 82, 96, 255;--ion-color-tertiary-contrast: #ffffff;--ion-color-tertiary-contrast-rgb: 255, 255, 255;--ion-color-tertiary-shade: #4854e0;--ion-color-tertiary-tint: #6370ff;--ion-color-success: #2dd36f;--ion-color-success-rgb: 45, 211, 111;--ion-color-success-contrast: #ffffff;--ion-color-success-contrast-rgb: 255, 255, 255;--ion-color-success-shade: #28ba62;--ion-color-success-tint: #42d77d;--ion-color-warning: #ffc409;--ion-color-warning-rgb: 255, 196, 9;--ion-color-warning-contrast: #000000;--ion-color-warning-contrast-rgb: 0, 0, 0;--ion-color-warning-shade: #e0ac08;--ion-color-warning-tint: #ffca22;--ion-color-danger: #eb445a;--ion-color-danger-rgb: 235, 68, 90;--ion-color-danger-contrast: #ffffff;--ion-color-danger-contrast-rgb: 255, 255, 255;--ion-color-danger-shade: #cf3c4f;--ion-color-danger-tint: #ed576b;--ion-color-dark: #222428;--ion-color-dark-rgb: 34, 36, 40;--ion-color-dark-contrast: #ffffff;--ion-color-dark-contrast-rgb: 255, 255, 255;--ion-color-dark-shade: #1e2023;--ion-color-dark-tint: #383a3e;--ion-color-medium: #92949c;--ion-color-medium-rgb: 146, 148, 156;--ion-color-medium-contrast: #ffffff;--ion-color-medium-contrast-rgb: 255, 255, 255;--ion-color-medium-shade: #808289;--ion-color-medium-tint: #9d9fa6;--ion-color-light: #f4f5f8;--ion-color-light-rgb: 244, 245, 248;--ion-color-light-contrast: #000000;--ion-color-light-contrast-rgb: 0, 0, 0;--ion-color-light-shade: #d7d8da;--ion-color-light-tint: #f5f6f9}"]})}return s})()}];let B=(()=>{class s{static#e=this.\u0275fac=function(i){return new(i||s)};static#r=this.\u0275mod=e.oAB({type:s});static#t=this.\u0275inj=e.cJS({imports:[f.Bz.forChild(U),f.Bz]})}return s})();var Z=o(4850);let J=(()=>{class s{static#e=this.\u0275fac=function(i){return new(i||s)};static#r=this.\u0275mod=e.oAB({type:s});static#t=this.\u0275inj=e.cJS({imports:[Z._o,Z.Nu,B]})}return s})()},2039:(b,h,o)=>{o.d(h,{c:()=>n});var f=o(4850),a=o(9063),y=o(4650);let n=(()=>{class m extends f.q2{constructor(){super(a.ih.Setting,"cpt",!0),this.getSystemConfig().subscribe(u=>{this.systemConfig=u})}getDeleted(u,v,T){return this.get({endPoint:[a.wm.settingsQuery],params:[{k:"type",v:u},{k:"sDate",v:JSON.stringify(v)},{k:"eDate",v:JSON.stringify(T)}]})}saveSystemConfig(u){return this.post({payload:u,endPoint:[a.yv.settingsStore,a.yv.saveSettings]})}getSystemConfig(){return this.get({endPoint:[a.wm.settingsQuery,a.wm.getSettings]})}static#e=this.\u0275fac=function(v){return new(v||m)};static#r=this.\u0275prov=y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()}}]);