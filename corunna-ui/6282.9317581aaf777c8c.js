"use strict";(self.webpackChunkcorunna_ui=self.webpackChunkcorunna_ui||[]).push([[6282],{6282:(b,m,r)=>{r.r(m),r.d(m,{SalesHistoryPageModule:()=>G});var y=r(9595),c=r(5861),S=r(4201),_=r(9063),i=r(8118),w=r(1038),f=r(8033),T=r(1247),Z=r(4850),v=r(5115),H=r(2958),B=r(4715),t=r(4650),C=r(2412),A=r(6895),g=r(4006),P=r(6297),U=r(2216),x=r(9492),N=r(2879),R=r(5694);function D(n,u){if(1&n&&(t.TgZ(0,"option",16),t._uU(1),t.qZA()),2&n){const e=u.$implicit;t.Q6J("value",e.branchName),t.xp6(1),t.Oqu(e.branchName)}}function J(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"select",15),t.NdJ("change",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.getSalesHistory())})("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.shopBranch=o)}),t.TgZ(1,"option",16),t._uU(2,"All"),t.qZA(),t.YNc(3,D,2,2,"option",17),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("ngModel",e.shopBranch),t.xp6(1),t.Q6J("value",null),t.xp6(2),t.Q6J("ngForOf",e.shopBranches)}}function E(n,u){if(1&n&&(t.TgZ(0,"span",30),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.AsE(" ","Deleted by: "+(null==e.deletedBy?null:e.deletedBy.firstName)+" "+(null==e.deletedBy?null:e.deletedBy.surName)," - ",t.xi3(2,2,e.deletedAt,"medium")," ")}}const O=function(n,u){return{rowData:n,i:u}};function I(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"tr",28),t.NdJ("swipe",function(o){const l=t.CHM(e).$implicit,d=t.oxw(2);return t.KtG(d.onSwipe(o,l))}),t.TgZ(1,"td"),t._uU(2),t._UZ(3,"br"),t.YNc(4,E,3,5,"span",29),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"number"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"number"),t.qZA()()}if(2&n){const e=u.$implicit,s=u.index,o=t.oxw(2);t.Q6J("ownContextMenu",o.rowMenu)("contextRow",t.WLB(13,O,e,s))("eventType",(o.platform.is("iphone"),"contextmenu")),t.xp6(2),t.hij(" ",e.itemName," "),t.xp6(2),t.Q6J("ngIf",e.deleted),t.xp6(2),t.Oqu(t.lcZ(7,9,e.unitSellingPrice)),t.xp6(3),t.AsE("",e.quantity," ",(null==e?null:e.quantityRemaining)>=0?" (r"+(null==e?null:e.quantityRemaining)+")":"",""),t.xp6(2),t.Oqu(t.lcZ(12,11,e.amount))}}function F(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar",18)(2,"ion-title",19),t._UZ(3,"fa-icon",20),t._uU(4," Sales Detail "),t.qZA()()(),t.TgZ(5,"ion-content",21)(6,"table",22)(7,"tbody")(8,"tr",23),t.NdJ("swipe",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.onSwipe(o,"item"))}),t.TgZ(9,"td"),t._uU(10,"Date:"),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA()(),t.TgZ(13,"tr")(14,"td"),t._uU(15,"Sold By:"),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.qZA()(),t.TgZ(18,"tr")(19,"td"),t._uU(20,"Shop Branch:"),t.qZA(),t.TgZ(21,"td"),t._uU(22),t.qZA()(),t.TgZ(23,"tr")(24,"td"),t._uU(25,"Total Amount:"),t.qZA(),t.TgZ(26,"td",24),t._uU(27),t.ALo(28,"number"),t.qZA()()()(),t.TgZ(29,"div",25),t._uU(30,"SALE ITEMS"),t.qZA(),t.TgZ(31,"table",26)(32,"thead")(33,"tr")(34,"th"),t._uU(35,"ITEM"),t.qZA(),t.TgZ(36,"th"),t._uU(37,"UNIT AMT"),t.qZA(),t.TgZ(38,"th"),t._uU(39,"QTTY"),t.qZA(),t.TgZ(40,"th"),t._uU(41,"TOTAL"),t.qZA()()(),t.TgZ(42,"tbody"),t.YNc(43,I,13,16,"tr",27),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(12),t.Oqu(e.selectedRow.createdAt),t.xp6(5),t.AsE("",null==e.selectedRow||null==e.selectedRow.userAccount?null:e.selectedRow.userAccount.userName," - ",null==e.selectedRow||null==e.selectedRow.userAccount?null:e.selectedRow.userAccount.firstName,""),t.xp6(5),t.Oqu(null==e.selectedRow||null==e.selectedRow.shopBranch?null:e.selectedRow.shopBranch.branchName),t.xp6(5),t.Oqu(t.lcZ(28,6,e.selectedRow.totalAmount||0)),t.xp6(16),t.Q6J("ngForOf",e.selectedRow.saleItems)}}const Y=function(){return{dateInputFormat:"DD/MM/YYYY",containerClass:"theme-blue",adaptivePosition:!0}},Q=function(){return[0,.6,.8,.95]},q=[{path:"",component:(()=>{class n{constructor(e,s,o,a,l,d){var M,p=this;this.dispensaryService=e,this.menuService=s,this.healmahDialogService=o,this.localStorageService=a,this.settingsService=l,this.platform=d,this.dates=[(0,w.Z)(new Date,3),new Date],this.sales=[],this.columns=[{field:"sno",header:"S/NO"},{field:"invoiceNo",header:"INVOICE"},{field:"itemsCount",header:"ITEMS"},{field:"totalAmount",header:"AMOUNT"},{field:"createdAt",header:"DATE"},{field:"branch",header:"BRANCH"}],this.tableMenu=[{iconLeft:"book-open",name:"Open",clickAction:()=>{this.selectedRow=this.menuService.contextRow.rowData,this.totalAmount=this.selectedRow.totalAmount,this.menuService.closeAllMenu(),this.modal.present().then(M=>{const h={saleHistoryModal:!0,desc:"fake state for our modal"};history.state.saleHistoryModal?history.replaceState(h,null):history.pushState(h,null)}),this.modal.onDidDismiss().then(()=>{history.state.saleHistoryModal&&history.back()})}}],this.rowMenu=[{iconLeft:"trash-alt",iconLeftStyle:"f:red!",name:"Delete Item",clickAction:(M=(0,c.Z)(function*(){if("Super"!==p.staff.acctType)return;const h=p.menuService.contextRow.rowData;p.menuService.closeAllMenu(),!h.deleted&&confirm("Are you to delete this sale and return to the stock?")&&p.dispensaryService.deleteSaleItem(h._id,h.id).subscribe(K=>{K?._id&&H.F.show({text:_.kt.itemDeleted,duration:"long"})})}),function(){return M.apply(this,arguments)})}],this.totalAmount=0,this.shopBranches=[],this.shopBranch=null}ionViewDidEnter(){this.getSalesHistory()}ngOnInit(){this.staff=JSON.parse(this.localStorageService.get("staff-profile")||"{}"),this.settingsService.getShopBranches().subscribe(e=>{this.shopBranches=e})}ngOnDestroy(){this.modal?.dismiss()}getSalesHistory(e){this.dispensaryService.getSalesHistory(this.dates,"Super"!==this.staff.acctType?this.staff.shopBranch?.branchName:this.shopBranch).subscribe(s=>{e&&e.target.complete(),this.sales=s.map((o,a)=>({sno:a+1,invoiceNo:o.invoiceNo,itemsCount:o.saleItems.length,saleItems:o.saleItems,totalAmount:o.saleItems.filter(l=>!l?.deleted).reduce((l,d)=>l+d.amount,0),createdAt:(0,f.Z)(new Date(o.createdAt),"d/M/yy - h:ma"),payMethod:o.payMethod,shopBranch:o.shopBranch,branch:o.shopBranch?.branchName,userAccount:o?.userAccount}))})}closeModal(){this.modal?.dismiss()}onSwipe(e,s){console.log(s),alert("Swiped"+s)}static#t=this.\u0275fac=function(s){return new(s||n)(t.Y36(T.t),t.Y36(S.hl),t.Y36(v.xA),t.Y36(Z.n2),t.Y36(B.g),t.Y36(C.t4))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["healmah-sales-history"]],viewQuery:function(s,o){if(1&s&&t.Gf(i.ki,5),2&s){let a;t.iGM(a=t.CRH())&&(o.modal=a.first)}},hostBindings:function(s,o){1&s&&t.NdJ("popstate",function(l){return o.closeModal(l)},!1,t.Jf7)},decls:20,vars:14,consts:[["color","primary"],["slot","start"],["color","light",3,"defaultHref"],["slot","start","color","light"],["slot","fixed",3,"ionRefresh"],[3,"isCustomCaption","columns","data","rowContextMenu","rowContextMenuEventType"],["dt",""],["caption",""],[1,"d:flex","justify-content-between","gap-2"],[1,"p-input-icon-left","flex:2.5","d:flex!","bg:white!"],[1,"pi","pi-search"],["type","search","placeholder","Search",1,"form-control","shadow-none","ps-5","b:none!",3,"placeholder","input"],["class","form-control form-select b:none! shadow:none! flex-basis:70px!",3,"ngModel","change","ngModelChange",4,"ngIf"],["type","text","bsDaterangepicker","","container","body",1,"form-control","flex:1","shadow:none!",3,"bsConfig","ngModel","ngModelChange"],["handleBehavior","cycle",3,"initialBreakpoint","breakpoints"],[1,"form-control","form-select","b:none!","shadow:none!","flex-basis:70px!",3,"ngModel","change","ngModelChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["color","primary",1,"ion-padding-horizontal"],[1,"text-align:center!","d:flex!","gap:10"],["icon","book-open"],[1,"ion-padding"],[1,"table","table-success"],[3,"swipe"],["currency",""],[1,"text-center","text-decoration-underline"],[1,"table","table-info","table-striped"],["contextMenu","",3,"ownContextMenu","contextRow","eventType","swipe",4,"ngFor","ngForOf"],["contextMenu","",3,"ownContextMenu","contextRow","eventType","swipe"],["class","f:red! f:0.8rem",4,"ngIf"],[1,"f:red!","f:0.8rem"]],template:function(s,o){if(1&s){const a=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA(),t.TgZ(4,"ion-title",3),t._uU(5,"Sales History"),t.qZA()()(),t.TgZ(6,"ion-content")(7,"ion-refresher",4),t.NdJ("ionRefresh",function(d){return o.getSalesHistory(d)}),t._UZ(8,"ion-refresher-content"),t.qZA(),t.TgZ(9,"prime-table",5,6)(11,"header",7)(12,"div",8)(13,"span",9),t._UZ(14,"i",10),t.TgZ(15,"input",11),t.NdJ("input",function(d){t.CHM(a);const p=t.MAs(10);return t.KtG(p.searchTable(d))}),t.qZA(),t.YNc(16,J,4,3,"select",12),t.qZA(),t.TgZ(17,"input",13),t.NdJ("ngModelChange",function(d){return o.dates=d})("ngModelChange",function(){return o.getSalesHistory()}),t.qZA()()()(),t.TgZ(18,"ion-modal",14),t.YNc(19,F,44,8,"ng-template"),t.qZA()()}2&s&&(t.xp6(3),t.Q6J("defaultHref",null==o.staff||null==o.staff.acctType?null:o.staff.acctType.toLowerCase()),t.xp6(6),t.Q6J("isCustomCaption",!0)("columns",o.columns)("data",o.sales)("rowContextMenu",o.tableMenu)("rowContextMenuEventType",o.platform.is("iphone")?"click":"contextmenu"),t.xp6(6),t.Q6J("placeholder",o.sales.length+" items"),t.xp6(1),t.Q6J("ngIf","Super"==(null==o.staff?null:o.staff.acctType)),t.xp6(1),t.Q6J("bsConfig",t.DdM(12,Y))("ngModel",o.dates),t.xp6(1),t.Q6J("initialBreakpoint",.6)("breakpoints",t.DdM(13,Q)))},dependencies:[A.sg,A.O5,g.YN,g.Kr,g.Fj,g.EJ,g.JJ,g.On,P.Sf,i.Sm,i.W2,i.Gu,i.nJ,i.Wo,i.wd,i.sr,i.ki,i.oU,U.BN,x.FR,x.TB,N.I,R.l,A.JJ,A.uU],styles:["[_nghost-%COMP%]{--ion-color-primary: #EA6D35;--ion-color-primary-rgb: 56, 128, 255;--ion-color-primary-contrast: #ffffff;--ion-color-primary-contrast-rgb: 255, 255, 255;--ion-color-primary-shade: #3171e0;--ion-color-primary-tint: #4c8dff;--ion-color-secondary: #1A2031;--ion-color-secondary-rgb: 61, 194, 255;--ion-color-secondary-contrast: #ffffff;--ion-color-secondary-contrast-rgb: 255, 255, 255;--ion-color-secondary-shade: #36abe0;--ion-color-secondary-tint: #50c8ff;--ion-color-tertiary: #F4E9E9;--ion-color-tertiary-rgb: 82, 96, 255;--ion-color-tertiary-contrast: #ffffff;--ion-color-tertiary-contrast-rgb: 255, 255, 255;--ion-color-tertiary-shade: #4854e0;--ion-color-tertiary-tint: #6370ff;--ion-color-success: #2dd36f;--ion-color-success-rgb: 45, 211, 111;--ion-color-success-contrast: #ffffff;--ion-color-success-contrast-rgb: 255, 255, 255;--ion-color-success-shade: #28ba62;--ion-color-success-tint: #42d77d;--ion-color-warning: #ffc409;--ion-color-warning-rgb: 255, 196, 9;--ion-color-warning-contrast: #000000;--ion-color-warning-contrast-rgb: 0, 0, 0;--ion-color-warning-shade: #e0ac08;--ion-color-warning-tint: #ffca22;--ion-color-danger: #eb445a;--ion-color-danger-rgb: 235, 68, 90;--ion-color-danger-contrast: #ffffff;--ion-color-danger-contrast-rgb: 255, 255, 255;--ion-color-danger-shade: #cf3c4f;--ion-color-danger-tint: #ed576b;--ion-color-dark: #222428;--ion-color-dark-rgb: 34, 36, 40;--ion-color-dark-contrast: #ffffff;--ion-color-dark-contrast-rgb: 255, 255, 255;--ion-color-dark-shade: #1e2023;--ion-color-dark-tint: #383a3e;--ion-color-medium: #f3f3f3;--ion-color-medium-rgb: 146, 148, 156;--ion-color-medium-contrast: #ffffff;--ion-color-medium-contrast-rgb: 255, 255, 255;--ion-color-medium-shade: #808289;--ion-color-medium-tint: #9d9fa6;--ion-color-light: #f4f5f8;--ion-color-light-rgb: 244, 245, 248;--ion-color-light-contrast: #000000;--ion-color-light-contrast-rgb: 0, 0, 0;--ion-color-light-shade: #d7d8da;--ion-color-light-tint: #f5f6f9}"]})}return n})()}];let L=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[y.Bz.forChild(q),y.Bz]})}return n})(),G=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[Z._o,Z.Nu,v.gw,L,S.HV,v.z8]})}return n})()},4715:(b,m,r)=>{r.d(m,{g:()=>_});var y=r(4850),c=r(9063),S=r(4650);let _=(()=>{class i extends y.q2{constructor(){super(c.ih.Setting,"dvt",!0)}saveShopBranch(f){return this.post({endPoint:[c.yv.settingsStore,c.yv.shopBranch],payload:f})}assignToShop(f){return this.put({endPoint:[c.yv.settingsStore,c.yv.shopBranch],payload:f})}getShopBranches(){return this.get({endPoint:[c.wm.settingsQuery,c.wm.shopBranch]})}deleteShopBranch(f){return this.delete({payload:f,endPoint:[c.yv.settingsStore,c.yv.shopBranch]})}static#t=this.\u0275fac=function(T){return new(T||i)};static#e=this.\u0275prov=S.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})()}}]);