"use strict";(self.webpackChunkcorunna_ui=self.webpackChunkcorunna_ui||[]).push([[547],{547:(S,h,e)=>{e.d(h,{R:()=>w});var d=e(5861),i=e(5115),u=e(4201),f=e(9063),a=e(8115),D=e(895),c=e(5119),r=e(8033),_=e(8359),p=e(4850),O=e(2958),b=e(6109),T=e(2039),t=e(4650),m=e(8118),C=e(9595),E=e(6895),v=e(4006),I=e(2216),U=e(9492),H=e(2879);const R=function(){return{dateInputFormat:"DD/MM/YYYY",containerClass:"theme-blue",adaptivePosition:!0}};function B(l,Z){if(1&l){const o=t.EpF();t.TgZ(0,"input",7),t.NdJ("ngModelChange",function(n){t.CHM(o);const P=t.oxw();return t.KtG(P.sDate=n)}),t.qZA()}if(2&l){const o=t.oxw();t.Q6J("ngModel",o.sDate)("bsConfig",t.DdM(2,R))}}function K(l,Z){if(1&l&&(t.TgZ(0,"h2",19),t._uU(1),t.ALo(2,"number"),t.TgZ(3,"span"),t._uU(4,"Total"),t.qZA()()),2&l){const o=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,null==o.salesHistory||null==o.salesHistory.main?null:o.salesHistory.main.amount)," ")}}function W(l,Z){if(1&l&&(t.TgZ(0,"div",20)(1,"section",21)(2,"h3"),t._uU(3),t.ALo(4,"number"),t.qZA(),t._uU(5," Amount "),t.qZA(),t.TgZ(6,"section")(7,"h3"),t._uU(8),t.ALo(9,"number"),t.qZA(),t._uU(10," Profit "),t.qZA()()),2&l){const o=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,2,null==o.salesHistory||null==o.salesHistory.main?null:o.salesHistory.main.amount)," "),t.xp6(5),t.hij(" ",t.lcZ(9,4,null==o.salesHistory||null==o.salesHistory.main?null:o.salesHistory.main.profit)," ")}}function k(l,Z){if(1&l&&(t.TgZ(0,"div")(1,"h3"),t._uU(2),t.qZA(),t.TgZ(3,"span",22),t._uU(4),t.qZA()()),2&l){const o=Z.$implicit;t.xp6(2),t.Oqu((null==o?null:o._id)||"None"),t.xp6(2),t.Oqu(null==o?null:o.amount)}}let w=(()=>{class l{constructor(o,s,n,P,A,N,J,Y){var M,g=this;this.modalCtrl=o,this.systemConfigService=s,this.dashboardSaleService=n,this.localStorageService=P,this.menuService=A,this.dialogService=N,this.router=J,this.stocksService=Y,this.sDate=new Date,this.eDate=new Date,this.salesHistory={},this.columns=[{field:"invoiceId",header:"ID"},{field:"itemName",header:"ITEM"},{field:"quantity",header:"QTTY"},{field:"amount",header:"AMT"},{field:"date",header:"DATE"},{field:"user",header:"USER"}],this.tableMenu=[{name:"Delete Stock",iconLeft:"trash-alt",clickAction:(M=(0,d.Z)(function*(){const y=g.menuService.contextRow.rowData;g.menuService.closeAllMenu(),g.dialogService.openConfirmDialog({title:"Confirm Action",message:"Deleting sold stock is irreversible, sure to continue?"}).subscribe(x=>{x&&g.dashboardSaleService.deleteDashboardSale(y.batchId,y._id,"single").subscribe(L=>{L?._id&&(O.F.show({text:f.kt.itemDeleted}),g.getSalesHistory(),g.stocksService.updateReport.next(!0))})})}),function(){return M.apply(this,arguments)}),iconLeftStyle:"f:rgb(173,55,57)"},{name:"",divider:!0,clickAction:function(){var M=(0,d.Z)(function*(){});return function(){return M.apply(this,arguments)}}()},{name:"",divider:!0,clickAction:function(){var M=(0,d.Z)(function*(){});return function(){return M.apply(this,arguments)}}()},{name:"Delete Batch",iconLeft:"trash",clickAction:function(){var M=(0,d.Z)(function*(){const y=g.menuService.contextRow.rowData;g.menuService.closeAllMenu(),g.dialogService.openConfirmDialog({title:"Confirm Action",message:"Deleting sold stock items is irreversible, sure to continue?"}).subscribe(x=>{x&&g.dashboardSaleService.deleteDashboardSale(y.batchId,y._id,"batch").subscribe(L=>{L?.modifiedCount&&(O.F.show({text:f.kt.itemDeleted}),g.getSalesHistory(),g.stocksService.updateReport.next(!0))})})});return function(){return M.apply(this,arguments)}}(),iconLeftStyle:"f:red"}]}ngOnInit(){this.staff=JSON.parse(this.localStorageService.get("staff-profile")||"{}"),this.getSalesHistory(),this.systemConfigService.getSystemConfig().subscribe(o=>{this.settings=o,"Daily"==this.settings.commissionRange&&(this.sDate=(0,a.Z)(new Date)),"Weekly"==this.settings.commissionRange&&(this.sDate=(0,D.Z)(new Date)),"Monthly"==this.settings.commissionRange&&(this.sDate=(0,c.Z)(new Date))})}ngOnDestroy(){}ionViewDidEnter(){this.staff=JSON.parse(this.localStorageService.get("staff-profile")||"{}"),"Super"!==this.staff.acctType&&(this.tableMenu=[]),this.getSalesHistory()}getSalesHistory(){"Standard"==this.staff?.acctType&&(this.eDate=new Date,this.sDate=new Date),this.dashboardSaleService.getDashboardServices(this.sDate,this.eDate).subscribe(o=>{this.salesHistory=o,this.salesHistory.sales=this.salesHistory?.sales.map(s=>({_id:s._id,amount:s.amount,batchId:s.batchId,invoiceId:s.invoiceId,itemId:s.itemId,itemName:s.itemName,payMethod:s.payMethod,quantity:s.quantity,unitCostPrice:s.unitCostPrice,unitSellingPrice:s.unitSellingPrice,date:(0,r.Z)(new Date(s.createdAt??new Date),"d/M/y - h:ma"),user:s?.userAccount}))})}closeModal(){this.router.navigate(["Super"==this.staff.acctType?"/super/stock-home":this.staff.acctType?.toLowerCase()])}static#t=this.\u0275fac=function(s){return new(s||l)(t.Y36(m.IN),t.Y36(T.c),t.Y36(_.N),t.Y36(p.n2),t.Y36(u.hl),t.Y36(i.xA),t.Y36(C.F0),t.Y36(b.T))};static#e=this.\u0275cmp=t.Xpm({type:l,selectors:[["healmah-sales-history"]],hostBindings:function(s,n){1&s&&t.NdJ("popstate",function(A){return n.closeModal(A)},!1,t.Jf7)},decls:21,vars:12,consts:[["color","secondary"],["slot","start"],["color","light",3,"defaultHref"],["color","light","slot","end"],["color","primary"],[1,"flex","gap:5","p:10","{b:#0F85E9!;f:white}_input"],["class","form-control bg:transparent! r:0!","type","text","bsDatepicker","",3,"ngModel","bsConfig","ngModelChange",4,"ngIf"],["type","text","bsDatepicker","",1,"form-control","bg:transparent!","r:0!",3,"ngModel","bsConfig","ngModelChange"],[1,"btn","btn-outline-primary","r:0!","bg:#0F85E9",3,"click"],["icon","search"],[1,"p:10"],[1,"p:10","f:white!","flex","gap:10","jc:space-around","bg:transparent","shadow:0|0|5px|rgba(255,255,255,0.2);","{text-align:center}"],[1,"flex","flex:column","ai:center","jc:space-between","flex:1"],["class","flex flex:column text-align:center",4,"ngIf"],["class"," flex gap:5",4,"ngIf"],[1,"w:100%","flex","jc:space-between","bt:1|rgba(255,255,255,0.4)|solid","gap:10","text-align:center"],[4,"ngFor","ngForOf"],[1,"p:4"],[3,"columns","data","rowsPerPage","rowContextMenu"],[1,"flex","flex:column","text-align:center"],[1,"flex","gap:5"],[1,"br:1|solid|rgba(0,0,0,0.2)","pr:5"],[1,"d-block"]],template:function(s,n){1&s&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA(),t.TgZ(4,"ion-title",3),t._uU(5,"Sales History"),t.qZA()()(),t.TgZ(6,"ion-content",4)(7,"div",5),t.YNc(8,B,1,3,"input",6),t.TgZ(9,"input",7),t.NdJ("ngModelChange",function(A){return n.eDate=A}),t.qZA(),t.TgZ(10,"button",8),t.NdJ("click",function(){return n.getSalesHistory()}),t._UZ(11,"fa-icon",9),t.qZA()(),t.TgZ(12,"header",10)(13,"div",11)(14,"section",12),t.YNc(15,K,5,3,"h2",13),t.YNc(16,W,11,6,"div",14),t.TgZ(17,"h2",15),t.YNc(18,k,5,2,"div",16),t.qZA()()()(),t.TgZ(19,"main",17),t._UZ(20,"prime-table",18),t.qZA()()),2&s&&(t.xp6(3),t.Q6J("defaultHref",null==n.staff||null==n.staff.acctType?null:n.staff.acctType.toLowerCase()),t.xp6(5),t.Q6J("ngIf","Standard"!==(null==n.staff?null:n.staff.acctType)),t.xp6(1),t.Q6J("ngModel",n.eDate)("bsConfig",t.DdM(11,R)),t.xp6(6),t.Q6J("ngIf","Super"!==(null==n.staff?null:n.staff.acctType)),t.xp6(1),t.Q6J("ngIf","Super"==(null==n.staff?null:n.staff.acctType)),t.xp6(2),t.Q6J("ngForOf",null==n.salesHistory?null:n.salesHistory.byPayMethod),t.xp6(2),t.Q6J("columns",n.columns)("data",null==n.salesHistory?null:n.salesHistory.sales)("rowsPerPage",25)("rowContextMenu",n.tableMenu))},dependencies:[E.sg,E.O5,v.Fj,v.JJ,v.On,m.Sm,m.W2,m.Gu,m.wd,m.sr,m.oU,I.BN,U.Np,U.Y5,H.I,E.JJ],styles:["[_nghost-%COMP%]{--ion-color-primary: #333B46;--ion-color-primary-rgb: 56, 128, 255;--ion-color-primary-contrast: #ffffff;--ion-color-primary-contrast-rgb: 255, 255, 255;--ion-color-primary-shade: #333B46;--ion-color-primary-tint: #333B46;--ion-color-secondary: #1F2630;--ion-color-secondary-rgb: 61, 194, 255;--ion-color-secondary-contrast: #ffffff;--ion-color-secondary-contrast-rgb: 255, 255, 255;--ion-color-secondary-shade: #1F2630;--ion-color-secondary-tint: #1F2630;--ion-color-tertiary: #f3f3f3;--ion-color-tertiary-rgb: 82, 96, 255;--ion-color-tertiary-contrast: #ffffff;--ion-color-tertiary-contrast-rgb: 255, 255, 255;--ion-color-tertiary-shade: #4854e0;--ion-color-tertiary-tint: #6370ff;--ion-color-success: #2dd36f;--ion-color-success-rgb: 45, 211, 111;--ion-color-success-contrast: #ffffff;--ion-color-success-contrast-rgb: 255, 255, 255;--ion-color-success-shade: #28ba62;--ion-color-success-tint: #42d77d;--ion-color-warning: #ffc409;--ion-color-warning-rgb: 255, 196, 9;--ion-color-warning-contrast: #000000;--ion-color-warning-contrast-rgb: 0, 0, 0;--ion-color-warning-shade: #e0ac08;--ion-color-warning-tint: #ffca22;--ion-color-danger: #eb445a;--ion-color-danger-rgb: 235, 68, 90;--ion-color-danger-contrast: #ffffff;--ion-color-danger-contrast-rgb: 255, 255, 255;--ion-color-danger-shade: #cf3c4f;--ion-color-danger-tint: #ed576b;--ion-color-dark: #222428;--ion-color-dark-rgb: 34, 36, 40;--ion-color-dark-contrast: #ffffff;--ion-color-dark-contrast-rgb: 255, 255, 255;--ion-color-dark-shade: #1e2023;--ion-color-dark-tint: #383a3e;--ion-color-medium: #92949c;--ion-color-medium-rgb: 146, 148, 156;--ion-color-medium-contrast: #ffffff;--ion-color-medium-contrast-rgb: 255, 255, 255;--ion-color-medium-shade: #808289;--ion-color-medium-tint: #9d9fa6;--ion-color-light: #f4f5f8;--ion-color-light-rgb: 244, 245, 248;--ion-color-light-contrast: #000000;--ion-color-light-contrast-rgb: 0, 0, 0;--ion-color-light-shade: #d7d8da;--ion-color-light-tint: #f5f6f9}"]})}return l})()},2039:(S,h,e)=>{e.d(h,{c:()=>f});var d=e(4850),i=e(9063),u=e(4650);let f=(()=>{class a extends d.q2{constructor(){super(i.ih.Setting,"cpt",!0),this.getSystemConfig().subscribe(c=>{this.systemConfig=c})}getDeleted(c,r,_){return this.get({endPoint:[i.wm.settingsQuery],params:[{k:"type",v:c},{k:"sDate",v:JSON.stringify(r)},{k:"eDate",v:JSON.stringify(_)}]})}saveSystemConfig(c){return this.post({payload:c,endPoint:[i.yv.settingsStore,i.yv.saveSettings]})}getSystemConfig(){return this.get({endPoint:[i.wm.settingsQuery,i.wm.getSettings]})}static#t=this.\u0275fac=function(r){return new(r||a)};static#e=this.\u0275prov=u.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()},8359:(S,h,e)=>{e.d(h,{N:()=>a});var d=e(4850),i=e(9063),u=e(4650),f=e(8118);let a=(()=>{class D extends d.q2{constructor(r){super(i.ih.STOCK,"cpt",!0),this.modalCtrl=r}getOverview(r,_){return this.get({endPoint:[i.kg.stockQuery],params:[{k:"sDate",v:JSON.stringify(r)},{k:"eDate",v:JSON.stringify(_)}]})}getDashboardServices(r,_){return this.get({endPoint:[i.kg.stockQuery,i.cY.dispenseHistory],params:[{k:"sDate",v:JSON.stringify(r)},{k:"eDate",v:JSON.stringify(_)}]})}deleteDashboardSale(r,_,p){return this.delete({payload:_,params:[{k:"batchId",v:r},{k:"type",v:p}],endPoint:[i.ve.stockStore,i.eb.returnSaleItems]})}static#t=this.\u0275fac=function(_){return new(_||D)(u.LFG(f.IN))};static#e=this.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})()},8115:(S,h,e)=>{e.d(h,{Z:()=>u});var d=e(953),i=e(833);function u(f){(0,i.Z)(1,arguments);var a=(0,d.Z)(f);return a.setHours(0,0,0,0),a}},5119:(S,h,e)=>{e.d(h,{Z:()=>u});var d=e(953),i=e(833);function u(f){(0,i.Z)(1,arguments);var a=(0,d.Z)(f);return a.setDate(1),a.setHours(0,0,0,0),a}},895:(S,h,e)=>{e.d(h,{Z:()=>a});var d=e(953),i=e(1998),u=e(833),f=e(8370);function a(D,c){var r,_,p,O,b,T,t,m;(0,u.Z)(1,arguments);var C=(0,f.j)(),E=(0,i.Z)(null!==(r=null!==(_=null!==(p=null!==(O=c?.weekStartsOn)&&void 0!==O?O:null==c||null===(b=c.locale)||void 0===b||null===(T=b.options)||void 0===T?void 0:T.weekStartsOn)&&void 0!==p?p:C.weekStartsOn)&&void 0!==_?_:null===(t=C.locale)||void 0===t||null===(m=t.options)||void 0===m?void 0:m.weekStartsOn)&&void 0!==r?r:0);if(!(E>=0&&E<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var v=(0,d.Z)(D),I=v.getDay(),U=(I<E?7:0)+I-E;return v.setDate(v.getDate()-U),v.setHours(0,0,0,0),v}}}]);