"use strict";(self.webpackChunkcorunna_ui=self.webpackChunkcorunna_ui||[]).push([[736],{736:(I,h,o)=>{o.r(h),o.d(h,{RenderServicePageModule:()=>J});var g=o(9595),v=o(5861),S=o(5857),n=o(4006),l=o(392),d=o(9063),c=o(5115),m=o(2958),p=o(6177),T=o(9652),e=o(4650),_=o(8398),A=o(2412),f=o(8118),y=o(6895),P=o(6726),x=o(2216),U=o(1191);function O(s,Z){if(1&s){const t=e.EpF();e.TgZ(0,"div")(1,"div",29)(2,"div",30)(3,"label"),e._uU(4,"Service:"),e.qZA(),e.TgZ(5,"input",31),e.NdJ("typeaheadOnSelect",function(r){const a=e.CHM(t).index,b=e.MAs(10);return e.oxw().serviceSelected(r,a),e.KtG(b.focus())}),e.qZA()(),e.TgZ(6,"div",32)(7,"label"),e._uU(8,"x:"),e.qZA(),e.TgZ(9,"input",33,34),e.NdJ("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.numOfTimesChanged())}),e.qZA()(),e.TgZ(11,"div",35)(12,"label"),e._uU(13,"PM:"),e.qZA(),e.TgZ(14,"select",36)(15,"option",37),e._uU(16,"Cash"),e.qZA(),e.TgZ(17,"option",38),e._uU(18,"Bank"),e.qZA()()(),e.TgZ(19,"fa-icon",39),e.NdJ("click",function(){const u=e.CHM(t).index,a=e.oxw();return e.KtG(a.removeServiceItem(u))}),e.qZA()()()}if(2&s){const t=Z.index,i=e.oxw();e.xp6(1),e.Q6J("formGroupName",t),e.xp6(4),e.Q6J("typeahead",i.services)("typeaheadOptionsLimit",15)}}function F(s,Z){if(1&s){const t=e.EpF();e.TgZ(0,"button",40),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.printInvoice())}),e._UZ(1,"fa-icon",41),e.qZA()}}function R(s,Z){if(1&s&&(e.TgZ(0,"tr",42)(1,"td",43),e._uU(2),e.qZA(),e.TgZ(3,"td",43),e._uU(4),e.ALo(5,"number"),e.qZA(),e.TgZ(6,"td",43),e._uU(7),e.ALo(8,"number"),e.qZA(),e.TgZ(9,"td",43),e._uU(10),e.qZA(),e.TgZ(11,"td",43),e._uU(12),e.ALo(13,"number"),e.ALo(14,"number"),e.qZA()()),2&s){const t=Z.$implicit;e.xp6(2),e.hij(" ",null==t?null:t.serviceName," "),e.xp6(2),e.hij(" ",e.lcZ(5,7,null==t?null:t.serviceCost)," "),e.xp6(3),e.AsE(" ",e.lcZ(8,9,null==t?null:t.commissionAmount)," (",null==t?null:t.serviceCommission,"%) "),e.xp6(3),e.hij(" ",null==t?null:t.numOfTimes," "),e.xp6(2),e.AsE(" ",e.lcZ(13,11,((null==t?null:t.serviceCost)||1)*((null==t?null:t.numOfTimes)||1))," ~ ",e.lcZ(14,13,((null==t?null:t.commissionAmount)||1)*((null==t?null:t.numOfTimes)||1))," ")}}const w=[{path:"",component:(()=>{class s{constructor(t,i,r,u,a,b,N,k){this.toastService=t,this.servicesService=i,this.localStorageService=r,this.userAccountService=u,this.platform=a,this.systemConfigService=b,this.printerService=N,this.router=k,this.services=[],this.staffAccounts=[],this.serviceBy={},this.totalAmount=0,this.process=E=>this.serviceRenderForm.invalid||!this.serviceBy?._id?(m.F.show({text:d.xR.invalidForm,duration:"long",position:"top"}),Promise.resolve()):this.servicesService.renderService(this.serviceRenderForm.value,this.serviceBy),this.serviceRenderForm=new n.cw({serviceItems:new n.Oe([this.serviceItemGroup()]),renderedBy:new n.NI(null,[n.kI.required,n.kI.min(1)]),idempotencyKey:new n.NI((0,T.x0)())})}ionViewDidEnter(){this.resetForm(),this.staffAccounts=[],this.staff=JSON.parse(this.localStorageService.get("staff-profile")||"{}"),this.servicesService.serviceToPrint=null,this.servicesService.getServices().subscribe(t=>{this.services=t.map(i=>({serviceName:i.serviceName,serviceCommission:i.serviceCommission,serviceCost:i.serviceCost,display:i.serviceName+" ("+i.serviceCost+" ~ "+i?.serviceCommission+"%)"}))}),this.userAccountService.getAccounts().subscribe(t=>{t?.length&&t?.filter(i=>"Standard"!==i.acctType).forEach(i=>{this.staffAccounts.push({_id:i._id,userName:i.firstName+" "+i.surName})})})}serviceItemGroup(t){return new n.cw({serviceName:new n.NI(null,n.kI.required),serviceCost:new n.NI(null,[n.kI.required,n.kI.min(1)]),serviceCommission:new n.NI(null,[n.kI.required,n.kI.min(1)]),commissionAmount:new n.NI(null,[n.kI.required,n.kI.min(1)]),payMethod:new n.NI("Cash",n.kI.required),numOfTimes:new n.NI(1,[n.kI.required,n.kI.min(1)])})}get serviceItemArr(){return this.serviceRenderForm.get("serviceItems")}addServiceItem(){this.serviceItemArr.controls.at(0)?.get("serviceName")?.valid&&this.serviceItemArr.controls.at(0)?.get("numOfTimes")?.valid&&this.serviceItemArr.insert(0,this.serviceItemGroup())}removeServiceItem(t){this.serviceItemArr.length>1&&(this.serviceItemArr.removeAt(t),this.totalAmount=this.serviceItemArr.controls.reduce((i,r)=>i+parseFloat(r.get("serviceCost")?.value)*parseFloat(r.get("numOfTimes")?.value),0))}serviceSelected(t,i){const r=t.item;if(this.serviceItemArr.controls.filter(u=>u.get("serviceName")?.value==r.serviceName).length>=1)return this.serviceItemArr.controls.at(i)?.get("serviceName")?.reset(),void m.F.show({text:"Service already selected, please choose another",position:"bottom",duration:"long"});this.serviceItemArr.at(i)?.get("serviceName")?.setValue(r.serviceName),this.serviceItemArr.at(i)?.get("serviceCost")?.setValue(r.serviceCost),this.serviceItemArr.at(i)?.get("serviceCommission")?.setValue(r.serviceCommission),this.serviceItemArr.at(i)?.get("commissionAmount")?.setValue(r?.serviceCommission/100*r?.serviceCost||1),this.totalAmount=this.serviceItemArr.controls.reduce((u,a)=>u+parseFloat(a.get("serviceCost")?.value)*parseFloat(a.get("numOfTimes")?.value),0)}serviceByChange(t){this.serviceBy=t.item}numOfTimesChanged(){this.totalAmount=this.serviceItemArr.controls.reduce((t,i)=>t+parseFloat(i.get("serviceCost")?.value)*parseFloat(i.get("numOfTimes")?.value),0)}result(t){var i=this;return(0,v.Z)(function*(){t?._id&&(yield m.F.show({text:"Sale processed successfully",duration:"long",position:"top"}),i.servicesService.serviceToPrint=t,i.servicesService.updateReport.next(!0),i.resetForm())})()}resetForm(){this.serviceRenderForm.reset(),this.serviceItemArr.clear(),this.serviceItemArr.insert(0,this.serviceItemGroup()),this.totalAmount=0,this.serviceRenderForm.get("idempotencyKey")?.setValue((0,T.x0)())}printInvoice(){var t=this;return(0,v.Z)(function*(){yield t.printerService.printSectionToBle(t.servicesService.serviceToPrint,t.systemConfigService.systemConfig.printType,"print-section-admin")})()}closeModal(){this.router.navigate(["Super"==this.staff.acctType?"/super/hair-home":this.staff.acctType?.toLowerCase()])}static#e=this.\u0275fac=function(i){return new(i||s)(e.Y36(c.kl),e.Y36(l.r),e.Y36(_.n),e.Y36(S.N),e.Y36(A.t4),e.Y36(p.c),e.Y36(c.vP),e.Y36(g.F0))};static#r=this.\u0275cmp=e.Xpm({type:s,selectors:[["healmah-render-service"]],hostBindings:function(i,r){1&i&&e.NdJ("popstate",function(a){return r.closeModal(a)},!1,e.Jf7)},decls:66,vars:24,consts:[["color","primary"],["slot","start"],["color","light",3,"defaultHref"],["color","light","slot","end"],["color","tertiary",1,"ion-padding"],[1,"p:10","flex","my:40","flex:column","gap:10","{flex;flex:column;gap:15}>div","{f:black}_label","{b:#0F85E9!}_input","{b:#0F85E9!}_select","print-none",3,"formGroup"],["formArrayName","serviceItems"],[4,"ngFor","ngForOf"],[1,"f:blue"],[1,"d:flex!","flex-direction:column!","gap:15!"],["formControlName","renderedBy","type","text","typeaheadOptionField","userName",1,"form-control",3,"typeahead","typeaheadOnSelect"],[1,"text-center","f:black","f:bold","mt:25"],[1,"text-decoration-line-through","text-decoration-style:double"],["btnDisabler","",1,"btn","btn-outline-primary","mt:25",3,"handler","disableWhenProcessing","handle"],[1,"btn","btn-outline-warning","mt:25",3,"click"],["class","btn btn-outline-secondary mt:10",3,"click",4,"ngIf"],["id","print-section-admin",1,"w:100vw","f:black!","d:none","display:block@print","{text-align:center}>h2","{text-align:center}>h4","{text-align:center}>h6"],[2,"text-align","center","margin","0"],[2,"text-align","center","margin","0","font-family","monospace"],[2,"text-align","center"],[1,"f:beryl-1"],[1,"table","table-striped","table-bordered",2,"border","1px solid lightgray","width","100%"],[2,"caption-side","bottom","text-align","center","padding","10px"],["style","padding: 10px;",4,"ngFor","ngForOf"],["colspan","3"],["colspan","2"],["slot","fixed","vertical","top","horizontal","start"],["size","small",3,"click"],["name","add"],[1,"flex","gap:3",3,"formGroupName"],[1,"mt:10","flex:1"],["type","text","formControlName","serviceName","typeaheadOptionField","display","container","body",1,"form-control","rr:0!",3,"typeahead","typeaheadOptionsLimit","typeaheadOnSelect"],[1,"mt:10","flex-basis:35px"],["type","number","formControlName","numOfTimes",1,"form-control","rl:0!","rr:0!","px:0","pl:5!",3,"input"],["qtty",""],[1,"mt:10","flex-basis:55px"],["formControlName","payMethod",1,"form-control","form-select","pl:5!","rl:0!","rr:0!"],["value","Cash"],["value","Bank"],["icon","minus",1,"btn","btn-outline-warning","align-self-end","rl:0!",3,"click"],[1,"btn","btn-outline-secondary","mt:10",3,"click"],["icon","print"],[2,"padding","10px"],[2,"padding","10px","border-bottom","1px solid lightgray","border-right","1px solid lightgray"]],template:function(i,r){if(1&i&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title",3),e._uU(5,"Render Service"),e.qZA()()(),e.TgZ(6,"ion-content",4)(7,"form",5)(8,"div",6),e.YNc(9,O,20,3,"div",7),e.qZA(),e._UZ(10,"hr",8),e.TgZ(11,"div",9)(12,"div")(13,"label"),e._uU(14,"Rendered by:"),e.qZA(),e.TgZ(15,"input",10),e.NdJ("typeaheadOnSelect",function(a){return r.serviceByChange(a)}),e.qZA()(),e.TgZ(16,"h1",11),e._uU(17," Total: "),e.TgZ(18,"span",12),e._uU(19,"N"),e.qZA(),e._uU(20),e.qZA(),e.TgZ(21,"button",13),e.NdJ("handle",function(a){return r.result(a)}),e._uU(22,"Process "),e.qZA(),e.TgZ(23,"button",14),e.NdJ("click",function(){return r.resetForm()}),e._uU(24,"Reset"),e.qZA(),e.YNc(25,F,2,0,"button",15),e.qZA()(),e.TgZ(26,"div",16)(27,"h1",17),e._uU(28,"RICHMOND"),e.qZA(),e.TgZ(29,"h2",18),e._uU(30,"Beauty & Hair Studio"),e.qZA(),e.TgZ(31,"p",19),e._uU(32,"Shop 51 - IBB MALL, Shiroro Road, Tunga Minna"),e.qZA(),e.TgZ(33,"h4",17)(34,"span"),e._uU(35),e.ALo(36,"uppercase"),e.qZA()(),e._UZ(37,"hr",20),e.TgZ(38,"table",21)(39,"caption",22),e._uU(40),e.ALo(41,"date"),e.qZA(),e.TgZ(42,"thead")(43,"tr")(44,"th"),e._uU(45,"SERVICE"),e.qZA(),e.TgZ(46,"th"),e._uU(47,"COST"),e.qZA(),e.TgZ(48,"th"),e._uU(49,"COM"),e.qZA(),e.TgZ(50,"th"),e._uU(51,"TIMES"),e.qZA(),e.TgZ(52,"th"),e._uU(53,"TOT"),e.qZA()()(),e.TgZ(54,"tbody"),e.YNc(55,R,15,15,"tr",23),e.qZA(),e.TgZ(56,"tfoot")(57,"th",24),e._uU(58),e.ALo(59,"number"),e.qZA(),e.TgZ(60,"th",25),e._uU(61),e.ALo(62,"number"),e.qZA()()()(),e.TgZ(63,"ion-fab",26)(64,"ion-fab-button",27),e.NdJ("click",function(){return r.addServiceItem()}),e._UZ(65,"ion-icon",28),e.qZA()()()),2&i){let u,a;e.xp6(3),e.Q6J("defaultHref",null==r.staff||null==r.staff.acctType?null:r.staff.acctType.toLowerCase()),e.xp6(4),e.Q6J("formGroup",r.serviceRenderForm),e.xp6(2),e.Q6J("ngForOf",null==r.serviceItemArr?null:r.serviceItemArr.controls),e.xp6(6),e.Q6J("typeahead",r.staffAccounts),e.xp6(5),e.hij("",r.totalAmount," "),e.xp6(1),e.Q6J("handler",r.process)("disableWhenProcessing",!0),e.xp6(4),e.Q6J("ngIf",null==r.servicesService?null:r.servicesService.serviceToPrint),e.xp6(10),e.AsE("",e.lcZ(36,15,"Staff Service Invoice")," #",null==r.servicesService||null==r.servicesService.serviceToPrint?null:r.servicesService.serviceToPrint.invoiceId,""),e.xp6(5),e.AsE(" WELL DONE, ",(null==r.servicesService||null==r.servicesService.serviceToPrint||null==r.servicesService.serviceToPrint.renderedBy?null:r.servicesService.serviceToPrint.renderedBy.firstName)+" "+(null==r.servicesService||null==r.servicesService.serviceToPrint||null==r.servicesService.serviceToPrint.renderedBy?null:r.servicesService.serviceToPrint.renderedBy.surName)," @ ",e.xi3(41,17,null==r.servicesService||null==r.servicesService.serviceToPrint?null:r.servicesService.serviceToPrint.createdAt,"LLL M, yyyy - h:mma")," "),e.xp6(15),e.Q6J("ngForOf",null==r.servicesService||null==r.servicesService.serviceToPrint?null:r.servicesService.serviceToPrint.serviceItems),e.xp6(3),e.hij("Total Cost: ",e.lcZ(59,20,null==(u=r.servicesService.serviceToPrintTotals(null==r.servicesService?null:r.servicesService.serviceToPrint))?null:u.totalCost),""),e.xp6(3),e.hij("Total Commission: ",e.lcZ(62,22,null==(a=r.servicesService.serviceToPrintTotals(null==r.servicesService?null:r.servicesService.serviceToPrint))?null:a.totalCommission),"")}},dependencies:[y.sg,y.O5,n._Y,n.YN,n.Kr,n.Fj,n.wV,n.EJ,n.JJ,n.JL,n.sg,n.u,n.x0,n.CE,P.h,f.Sm,f.W2,f.IJ,f.W4,f.Gu,f.gu,f.wd,f.sr,f.oU,x.BN,U.Bp,y.gd,y.JJ,y.uU],styles:["[_nghost-%COMP%]{--ion-color-primary: #1F5BBC;--ion-color-primary-rgb: 56, 128, 255;--ion-color-primary-contrast: #ffffff;--ion-color-primary-contrast-rgb: 255, 255, 255;--ion-color-primary-shade: #3171e0;--ion-color-primary-tint: #4c8dff;--ion-color-secondary: #3dc2ff;--ion-color-secondary-rgb: 61, 194, 255;--ion-color-secondary-contrast: #ffffff;--ion-color-secondary-contrast-rgb: 255, 255, 255;--ion-color-secondary-shade: #36abe0;--ion-color-secondary-tint: #50c8ff;--ion-color-tertiary: #f3f3f3;--ion-color-tertiary-rgb: 82, 96, 255;--ion-color-tertiary-contrast: #ffffff;--ion-color-tertiary-contrast-rgb: 255, 255, 255;--ion-color-tertiary-shade: #4854e0;--ion-color-tertiary-tint: #6370ff;--ion-color-success: #2dd36f;--ion-color-success-rgb: 45, 211, 111;--ion-color-success-contrast: #ffffff;--ion-color-success-contrast-rgb: 255, 255, 255;--ion-color-success-shade: #28ba62;--ion-color-success-tint: #42d77d;--ion-color-warning: #ffc409;--ion-color-warning-rgb: 255, 196, 9;--ion-color-warning-contrast: #000000;--ion-color-warning-contrast-rgb: 0, 0, 0;--ion-color-warning-shade: #e0ac08;--ion-color-warning-tint: #ffca22;--ion-color-danger: #eb445a;--ion-color-danger-rgb: 235, 68, 90;--ion-color-danger-contrast: #ffffff;--ion-color-danger-contrast-rgb: 255, 255, 255;--ion-color-danger-shade: #cf3c4f;--ion-color-danger-tint: #ed576b;--ion-color-dark: #222428;--ion-color-dark-rgb: 34, 36, 40;--ion-color-dark-contrast: #ffffff;--ion-color-dark-contrast-rgb: 255, 255, 255;--ion-color-dark-shade: #1e2023;--ion-color-dark-tint: #383a3e;--ion-color-medium: #92949c;--ion-color-medium-rgb: 146, 148, 156;--ion-color-medium-contrast: #ffffff;--ion-color-medium-contrast-rgb: 255, 255, 255;--ion-color-medium-shade: #808289;--ion-color-medium-tint: #9d9fa6;--ion-color-light: #f4f5f8;--ion-color-light-rgb: 244, 245, 248;--ion-color-light-contrast: #000000;--ion-color-light-contrast-rgb: 0, 0, 0;--ion-color-light-shade: #d7d8da;--ion-color-light-tint: #f5f6f9}"]})}return s})()}];let B=(()=>{class s{static#e=this.\u0275fac=function(i){return new(i||s)};static#r=this.\u0275mod=e.oAB({type:s});static#t=this.\u0275inj=e.cJS({imports:[g.Bz.forChild(w),g.Bz]})}return s})();var C=o(4850);let J=(()=>{class s{static#e=this.\u0275fac=function(i){return new(i||s)};static#r=this.\u0275mod=e.oAB({type:s});static#t=this.\u0275inj=e.cJS({imports:[C._o,C.Nu,B]})}return s})()},6177:(I,h,o)=>{o.d(h,{c:()=>n});var g=o(4850),v=o(9063),S=o(4650);let n=(()=>{class l extends g.q2{constructor(){super(v.ih.Setting,"rmd",!0),this.getSystemConfig().subscribe(c=>{this.systemConfig=c})}getDeleted(c,m,p){return this.get({endPoint:[v.wm.settingsQuery],params:[{k:"type",v:c},{k:"sDate",v:JSON.stringify(m)},{k:"eDate",v:JSON.stringify(p)}]})}saveSystemConfig(c){return this.post({payload:c,endPoint:[v.yv.settingsStore,v.yv.saveSettings]})}getSystemConfig(){return this.get({endPoint:[v.wm.settingsQuery,v.wm.getSettings]})}static#e=this.\u0275fac=function(m){return new(m||l)};static#r=this.\u0275prov=S.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},9652:(I,h,o)=>{o.d(h,{x0:()=>n});let n=(l=21)=>crypto.getRandomValues(new Uint8Array(l)).reduce((d,c)=>d+((c&=63)<36?c.toString(36):c<62?(c-26).toString(36).toUpperCase():c>62?"-":"_"),"")}}]);