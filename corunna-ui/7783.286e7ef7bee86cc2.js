"use strict";(self.webpackChunkcorunna_ui=self.webpackChunkcorunna_ui||[]).push([[7783],{7783:(C,g,r)=>{r.r(g),r.d(g,{DataEntryViewModule:()=>B});var p=r(9595),y=r(5861),E=r(6463),_=r(5866),h=r(8307),c=r(4006),l=r(9808),m=r(4733),f=r(5115),u=r(4327),Z=r(374),T=r(8033),t=r(4650),D=r(6895),O=r(2993),N=r(8118),x=r(9492),v=r(5241);function w(n,s){1&n&&(t.TgZ(0,"option"),t._uU(1,"All"),t.qZA())}function U(n,s){if(1&n&&(t.TgZ(0,"option",17),t._uU(1),t.qZA()),2&n){const e=s.$implicit;t.Q6J("value",null==e?null:e._id),t.xp6(1),t.hij(" ",null==e?null:e.sectorName," ")}}function b(n,s){if(1&n&&(t.TgZ(0,"h4",24),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.lnq(" ",null==e||null==e.sector?null:e.sector.sectorName," . ",null==e||null==e.lga?null:e.lga.lgaName," . ",t.xi3(2,3,null==e?null:e.collectionDate,"mediumDate")," ")}}function F(n,s){if(1&n&&(t.TgZ(0,"h4",24),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.AsE(" ",null==e||null==e.sector?null:e.sector.sectorName," . ",t.xi3(2,2,null==e?null:e.collectionDate,"mediumDate")," ")}}function M(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.Oqu(null==e?null:e.inputLabel),t.xp6(2),t.Oqu(null==e?null:e.inputValue)}}function V(n,s){if(1&n&&(t.TgZ(0,"section")(1,"table",26)(2,"caption",27),t._uU(3),t.qZA(),t.TgZ(4,"thead")(5,"th"),t._uU(6,"Indicator"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Entered Value"),t.qZA()(),t.TgZ(9,"tbody"),t.YNc(10,M,5,2,"tr",25),t.qZA()()()),2&n){const e=s.$implicit;t.xp6(3),t.hij("OUTCOME: ",null==e?null:e.outcomeIndicator,""),t.xp6(7),t.Q6J("ngForOf",null==e?null:e.outputIndicatorsInputs)}}function J(n,s){if(1&n&&(t.TgZ(0,"main"),t.YNc(1,V,11,2,"section",25),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.outcomeOutputIndicators)}}function Y(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.Oqu(null==e?null:e.inputLabel),t.xp6(2),t.Oqu(null==e?null:e.inputValue)}}function Q(n,s){if(1&n&&(t.TgZ(0,"section")(1,"table",28)(2,"caption",27),t._uU(3),t.qZA(),t.TgZ(4,"thead")(5,"th"),t._uU(6,"Indicator"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Entered Value"),t.qZA()(),t.TgZ(9,"tbody"),t.YNc(10,Y,5,2,"tr",25),t.qZA()()()),2&n){const e=s.$implicit;t.xp6(3),t.hij("OUTCOME: ",null==e?null:e.outcomeIndicator,""),t.xp6(7),t.Q6J("ngForOf",null==e?null:e.outputIndicatorsInputs)}}function S(n,s){if(1&n&&(t.TgZ(0,"main"),t.YNc(1,Q,11,2,"section",25),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.outcomeIndicators)}}function q(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"accordion-group",18)(1,"header",19),t.YNc(2,b,3,6,"h4",20),t.YNc(3,F,3,5,"h4",20),t.TgZ(4,"span",21)(5,"ng-icon",22),t.NdJ("click",function(){const a=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.editEntry(a))}),t.qZA(),t.TgZ(6,"ng-icon",23),t.NdJ("click",function(){const a=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.deleteEntry(a))}),t.qZA()()(),t.YNc(7,J,2,1,"main",6),t.YNc(8,S,2,1,"main",6),t.qZA()}if(2&n){const e=s.$implicit;t.xp6(2),t.Q6J("ngIf",null==e.outcomeOutputIndicators?null:e.outcomeOutputIndicators.length),t.xp6(1),t.Q6J("ngIf",null==e.outcomeIndicators?null:e.outcomeIndicators.length),t.xp6(4),t.Q6J("ngIf",null==e.outcomeOutputIndicators?null:e.outcomeOutputIndicators.length),t.xp6(1),t.Q6J("ngIf",null==e.outcomeIndicators?null:e.outcomeIndicators.length)}}const A=function(){return{dateInputFormat:"DD/MM/YYYY",containerClass:"theme-blue",adaptivePosition:!0}},L=[{path:"",component:(()=>{class n{constructor(e,o,i,a,d){this.dataEntryService=e,this.sectorService=o,this.toastService=i,this.dialogService=a,this.router=d,this.sectors=[],this.sDate=(0,E.Z)(new Date,7),this.eDate=(0,_.Z)(new Date,7),this.dataEntries=[],this.dataEntryQueryForm=new c.cw({type:new c.NI("outputEntry"),sector:new c.NI("All"),sDate:new c.NI((0,E.Z)(new Date,7),c.kI.required),eDate:new c.NI((0,_.Z)(new Date,7),c.kI.required)})}ngOnInit(){}ionViewDidEnter(){var e=this;return(0,y.Z)(function*(){e.user=JSON.parse(localStorage.getItem("nix-staff")||"{}");const o=yield(0,l.n)(e.sectorService.getSectors());e.sectors="All"==e.user?.sector?.sectorName?o:o?.filter(i=>i?.sectorName?.toLowerCase()==e.user?.sector?.sectorName?.toLowerCase())||[],e.sectors=e.sectors?.filter(i=>"all"!==i?.sectorName?.toLowerCase())||[]})()}getDataEntries(){"All"!==this.user?.sector?.sectorName&&"All"==this.dataEntryQueryForm.get("sector")?.value&&this.dataEntryQueryForm.get("sector")?.setValue(this.user.sector?._id),this.dataEntryService.getDataEntries(this.dataEntryQueryForm.value).subscribe(e=>{this.dataEntries=e??[]})}deleteEntry(e){this.dialogService.openConfirmDialog({title:"Comfirm Action",message:"Are you sure to delete this entry?"}).subscribe(o=>{o&&this.dataEntryService.deleteDataEntry(e?._id).subscribe(i=>{i?._id&&this.getDataEntries()})})}editEntry(e){this.router.navigate(["core/data-entry","outputEntry"==e?.entryType?"outputs":"outcomes"],{state:e})}exportData(){var e=this;return(0,y.Z)(function*(){"All"!==e.user?.sector?.sectorName&&"All"==e.dataEntryQueryForm.get("sector")?.value&&e.dataEntryQueryForm.get("sector")?.setValue(e.user.sector?._id);let o=yield(0,l.n)(e.dataEntryService.getDataEntries({...e.dataEntryQueryForm.value,type:"outcomeEntry"==e.dataEntries.at(0)?.entryType?"outputEntry":"outcomeEntry"}));if(!e.dataEntries.length&&!o?.length)return;"outcomeEntry"==o?.at(0)?.entryType&&o.forEach(a=>{a.outcomeOutputIndicators=a.outcomeIndicators}),"outcomeEntry"==e.dataEntries?.at(0)?.entryType&&e.dataEntries.forEach(a=>{a.outcomeOutputIndicators=a.outcomeIndicators}),"outputEntry"==e.dataEntries?.at(0)?.entryType&&e.dataEntries.forEach(a=>{a.outcomeIndicators=[{outcomeIndicator:"",outputIndicatorsInputs:[{inputLabel:"",inputType:"",inputRequired:"",inputOptions:""}]}]}),"outputEntry"==o?.at(0)?.entryType&&o.forEach(a=>{a.outcomeIndicators=[{outcomeIndicator:"",outputIndicatorsInputs:[{inputLabel:"",inputType:"",inputRequired:"",inputOptions:""}]}]});const i={title:"Data Entries- "+(0,T.Z)(new Date(e.dataEntries.at(0)?e.dataEntries.at(0)?.collectionDate:o.at(0)?.collectionDate),"MMM d yyy")+" to "+(0,T.Z)(new Date(e.dataEntries.at(-1)?e.dataEntries.at(-1)?.collectionDate:o.at(-1)?.collectionDate),"MMM d yyy"),datae:[{type:"OUTPUT",entries:"outputEntry"==e.dataEntries.at(0)?.entryType?e.dataEntries:o??[]},{type:"OUTCOME",entries:"outputEntry"==e.dataEntries.at(0)?.entryType?o:e.dataEntries??[]}]};try{const a=yield fetch("assets/nix/data-view-template.xlsx").then(P=>P.arrayBuffer()),j=yield(yield(new Z.Renderer).renderFromArrayBuffer(a,i)).xlsx.writeBuffer();(0,u.saveAs)(new Blob([j]),`${Date.now()}_report.xlsx`)}catch(a){console.log(a)}})()}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(h.G),t.Y36(m.A),t.Y36(f.kl),t.Y36(f.xA),t.Y36(p.F0))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["healmah-data-entry-view"]],decls:33,vars:10,consts:[[1,"ion-padding"],[1,"flex","gap:10","{flex:1}>*",3,"formGroup"],["formControlName","type",1,"form-control","form-select","shadow-none"],["value","outputEntry"],["value","outcomeEntry"],["formControlName","sector",1,"form-control","form-select","shadow-none"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["bsDatepicker","","formControlName","sDate",1,"form-control","form-select","shadow-none",3,"bsConfig"],["bsDatepicker","","formControlName","eDate",1,"form-control","form-select","shadow-none",3,"bsConfig"],[1,"flex","gap:3","ai:flex-end"],[1,"btn","btn-primary","flex:1",3,"click"],[1,"btn","btn-secondary","flex:0.5",3,"click"],["name","faSolidFileExcel"],[1,"w:50%","mx:auto"],[3,"isAnimated","closeOthers"],["class","mb:5",4,"ngFor","ngForOf"],[3,"value"],[1,"mb:5"],["accordion-heading","","type","button",1,"flex","ai:center","jc:space-between","px:10"],["class","flex ai:center gap:10",4,"ngIf"],[1,"flex","gap:10"],["name","faSolidPen",1,"text-primary",3,"click"],["name","faSolidTrash",1,"text-warning",3,"click"],[1,"flex","ai:center","gap:10"],[4,"ngFor","ngForOf"],[1,"table","mat-elevation-z2","table-primary","table-striped","table-bordered","caption-top"],[1,"text-center"],[1,"table","table-primary","table-striped","table-bordered","caption-top"]],template:function(o,i){1&o&&(t.TgZ(0,"ion-content",0)(1,"form",1)(2,"div")(3,"label"),t._uU(4,"Sector:"),t.qZA(),t.TgZ(5,"select",2)(6,"option",3),t._uU(7,"OUTPUT"),t.qZA(),t.TgZ(8,"option",4),t._uU(9,"OUTCOME"),t.qZA()()(),t.TgZ(10,"div")(11,"label"),t._uU(12,"Sector:"),t.qZA(),t.TgZ(13,"select",5),t.YNc(14,w,2,0,"option",6),t.YNc(15,U,2,2,"option",7),t.qZA()(),t.TgZ(16,"div")(17,"label"),t._uU(18,"Start Date:"),t.qZA(),t._UZ(19,"input",8),t.qZA(),t.TgZ(20,"div")(21,"label"),t._uU(22,"End Date:"),t.qZA(),t._UZ(23,"input",9),t.qZA(),t.TgZ(24,"div",10)(25,"button",11),t.NdJ("click",function(){return i.getDataEntries()}),t._uU(26,"Load"),t.qZA(),t.TgZ(27,"button",12),t.NdJ("click",function(){return i.exportData()}),t._UZ(28,"ng-icon",13),t.qZA()()(),t._UZ(29,"hr",14),t.TgZ(30,"main")(31,"accordion",15),t.YNc(32,q,9,4,"accordion-group",16),t.qZA()()()),2&o&&(t.xp6(1),t.Q6J("formGroup",i.dataEntryQueryForm),t.xp6(13),t.Q6J("ngIf","All"==(null==i.user||null==i.user.sector?null:i.user.sector.sectorName)),t.xp6(1),t.Q6J("ngForOf",i.sectors),t.xp6(4),t.Q6J("bsConfig",t.DdM(8,A)),t.xp6(4),t.Q6J("bsConfig",t.DdM(9,A)),t.xp6(8),t.Q6J("isAnimated",!0)("closeOthers",!0),t.xp6(1),t.Q6J("ngForOf",i.dataEntries))},dependencies:[D.sg,D.O5,c._Y,c.YN,c.Kr,c.Fj,c.EJ,c.JJ,c.JL,c.sg,c.u,O.Fv,N.W2,x.Np,x.Y5,v.Zf,v.U_,D.uU]})}return n})()}];let $=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(L),p.Bz]})}return n})();var I=r(4850);let B=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[I._o,I.Nu,$]})}return n})()},5866:(C,g,r)=>{r.d(g,{Z:()=>_});var p=r(1998),y=r(953),E=r(833);function _(h,c){(0,E.Z)(2,arguments);var l=(0,y.Z)(h),m=(0,p.Z)(c);if(isNaN(m))return new Date(NaN);if(!m)return l;var f=l.getDate(),u=new Date(l.getTime());return u.setMonth(l.getMonth()+m+1,0),f>=u.getDate()?u:(l.setFullYear(u.getFullYear(),u.getMonth(),f),l)}}}]);